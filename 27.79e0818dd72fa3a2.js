"use strict";(self.webpackChunkfarm_360=self.webpackChunkfarm_360||[]).push([[27],{6304:(et,Fe,C)=>{C.d(Fe,{Dh:()=>se,GT:()=>Le,cc:()=>Ae,on:()=>re,pX:()=>G,xv:()=>fe});var b=C(5879),g=C(7142);et=C.hmd(et);const f=["ngOnDestroy"],G=(S,P,W,x={})=>new Proxy(S,{get:(Y,ae)=>W.runOutsideAngular(()=>{var le;if(S[ae])return!(null===(le=x?.spy)||void 0===le)&&le.get&&x.spy.get(ae,S[ae]),S[ae];if(f.indexOf(ae)>-1)return()=>{};const $=P.toPromise().then(O=>{const c=O&&O[ae];return"function"==typeof c?c.bind(O):c&&c.then?c.then(X=>W.run(()=>X)):W.run(()=>c)});return new Proxy(()=>{},{get:(O,c)=>$[c],apply:(O,c,X)=>$.then(me=>{var ue;const Re=me&&me(...X);return!(null===(ue=x?.spy)||void 0===ue)&&ue.apply&&x.spy.apply(ae,X,Re),Re})})})}),Le=(S,P)=>{P.forEach(W=>{Object.getOwnPropertyNames(W.prototype||W).forEach(x=>{Object.defineProperty(S.prototype,x,Object.getOwnPropertyDescriptor(W.prototype||W,x))})})};class Ye{constructor(P){return P}}const se=new b.OlP("angularfire2.app.options"),fe=new b.OlP("angularfire2.app.name");function re(S,P,W){const Y="object"==typeof W&&W||{};Y.name=Y.name||"string"==typeof W&&W||"[DEFAULT]";const le=g.Z.apps.filter($=>$&&$.name===Y.name)[0]||P.runOutsideAngular(()=>g.Z.initializeApp(S,Y));try{JSON.stringify(S)!==JSON.stringify(le.options)&&tt("error",`${le.name} Firebase App already initialized with different options${et.hot?", you may need to reload as Firebase is not HMR aware.":"."}`)}catch{}return new Ye(le)}const tt=(S,...P)=>{(0,b.X6Q)()&&typeof console<"u"&&console[S](...P)};function Ae(S,P,W,x,Y){const[,ae,le]=globalThis.\u0275AngularfireInstanceCache.find($=>$[0]===S)||[];if(ae)return function vt(S,P){try{return S.toString()===P.toString()}catch{return S===P}}(Y,le)||(Q("error",`${P} was already initialized on the ${W} Firebase App with different settings.${yt?" You may need to reload as Firebase is not HMR aware.":""}`),Q("warn",{is:Y,was:le})),ae;{const $=x();return globalThis.\u0275AngularfireInstanceCache.push([S,$,Y]),$}}const yt=!!et.hot,Q=(S,...P)=>{(0,b.X6Q)()&&typeof console<"u"&&console[S](...P)};globalThis.\u0275AngularfireInstanceCache||(globalThis.\u0275AngularfireInstanceCache=[])},3027:(et,Fe,C)=>{C.r(Fe),C.d(Fe,{CreateFarmComponent:()=>rd});var b=C(5861),g=C(5879),f=C(6321),G=C(5592),Le=C(2096),Ye=C(3019),se=C(7398),fe=C(3020),re=C(4664),tt=C(6699),ze=C(3997),mt=C(9360),Ae=C(8251),vt=C(4829),yt=C(2737),Q=C(2420),S=C(9940),x=C(8186),Y=C(6304),le=(C(6365),C(3106)),$=C(4537),O=C(534),c=C(9058),X=C(7879);const me="@firebase/database";let Re="";function kn(n){Re=n}class bi{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,c.Wl)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,c.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Dt{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,c.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Nn=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new bi(e)}}catch{}return new Dt},Ke=Nn("localStorage"),Kt=Nn("sessionStorage"),Qe=new X.Yd("@firebase/database"),Pn=function(){let n=1;return function(){return n++}}(),xn=function(n){const e=(0,c.dS)(n),t=new c.gQ;t.update(e);const i=t.digest();return c.US.encodeByteArray(i)},Ct=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?e+=Ct.apply(null,i):e+="object"==typeof i?(0,c.Wl)(i):i,e+=" "}return e};let $e=null,nt=!0;const Dn=function(n,e){(0,c.hu)(!e||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(Qe.logLevel=X.in.VERBOSE,$e=Qe.log.bind(Qe),e&&Kt.set("logging_enabled",!0)):"function"==typeof n?$e=n:($e=null,Kt.remove("logging_enabled"))},J=function(...n){if(!0===nt&&(nt=!1,null===$e&&!0===Kt.get("logging_enabled")&&Dn(!0)),$e){const e=Ct.apply(null,n);$e(e)}},Et=function(n){return function(...e){J(n,...e)}},Qt=function(...n){const e="FIREBASE INTERNAL ERROR: "+Ct(...n);Qe.error(e)},Ee=function(...n){const e=`FIREBASE FATAL ERROR: ${Ct(...n)}`;throw Qe.error(e),new Error(e)},ne=function(...n){const e="FIREBASE WARNING: "+Ct(...n);Qe.warn(e)},it=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ke="[MIN_NAME]",Ne="[MAX_NAME]",Pe=function(n,e){if(n===e)return 0;if(n===ke||e===Ne)return-1;if(e===ke||n===Ne)return 1;{const t=Ln(n),i=Ln(e);return null!==t?null!==i?t-i==0?n.length-e.length:t-i:-1:null!==i?1:n<e?-1:1}},Si=function(n,e){return n===e?0:n<e?-1:1},te=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+(0,c.Wl)(e))},Ze=function(n){if("object"!=typeof n||null===n)return(0,c.Wl)(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)0!==i&&(t+=","),t+=(0,c.Wl)(e[i]),t+=":",t+=Ze(n[e[i]]);return t+="}",t},Zt=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)i.push(n.substring(s,s+e>t?t:s+e));return i};function q(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Ot=function(n){(0,c.hu)(!it(n),"Invalid JSON number");const i=1023;let s,r,o,a,l;0===n?(r=0,o=0,s=1/n==-1/0?1:0):(s=n<0,(n=Math.abs(n))>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,52-a)-Math.pow(2,52))):(r=0,o=Math.round(n/Math.pow(2,-1074))));const u=[];for(l=52;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=11;l;l-=1)u.push(r%2?1:0),r=Math.floor(r/2);u.push(s?1:0),u.reverse();const _=u.join("");let m="";for(l=0;l<64;l+=8){let v=parseInt(_.substr(l,8),2).toString(16);1===v.length&&(v="0"+v),m+=v}return m.toLowerCase()},Ai=new RegExp("^-?(0*)\\d{1,10}$"),Ln=function(n){if(Ai.test(n)){const e=Number(n);if(e>=-2147483648&&e<=2147483647)return e}return null},st=function(n){try{n()}catch(e){setTimeout(()=>{throw ne("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},rt=function(n,e){const t=setTimeout(n,e);return"number"==typeof t&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class ce{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){ne(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Jt{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&"auth/token-not-initialized"===t.code?(J("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ne(e)}}let Xe=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const Wn=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Un="websocket",Vn="long_polling";class p{constructor(e,t,i,s,r=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ke.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ke.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function d(n,e,t){let i;if((0,c.hu)("string"==typeof e,"typeof type must == string"),(0,c.hu)("object"==typeof t,"typeof params must == object"),e===Un)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(e!==Vn)throw new Error("Unknown connection type: "+e);i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function h(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(t.ns=n.namespace);const s=[];return q(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}class y{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,c.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,c.p$)(this.counters_)}}const E={},T={};function M(n){const e=n.toString();return E[e]||(E[e]=new y),E[e]}class ie{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&st(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class at{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Et(e),this.stats_=M(t),this.urlFn=l=>(this.appCheckToken&&(l.ac=this.appCheckToken),d(t,Vn,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ie(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if((0,c.Yr)()||"complete"===document.readyState)n();else{let e=!1;const t=function(){document.body?e||(e=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ki((...r)=>{const[o,a,l,u,_]=r;if(this.incrementIncomingBytes_(r),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===o)this.id=a,this.password=l;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={start:"t"};i.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=this.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",this.transportSessionId&&(i.s=this.transportSessionId),this.lastSessionId&&(i.ls=this.lastSessionId),this.applicationId&&(i.p=this.applicationId),this.appCheckToken&&(i.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&Wn.test(location.hostname)&&(i.r="f");const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){at.forceAllow_=!0}static forceDisallow(){at.forceDisallow_=!0}static isAvailable(){return!((0,c.Yr)()||!at.forceAllow_&&(at.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=(0,c.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=(0,c.h$)(t),s=Zt(i,1840);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,c.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=e,i.pw=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=(0,c.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class ki{constructor(e,t,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,c.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Pn(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=ki.createIFrame_();let r="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){J("frame writing exception"),a.stack&&J(a.stack),J(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||J("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){const o=this.pendingSegs.shift();i=i+"&seg"+s+"="+o.seg+"&ts"+s+"="+o.ts+"&d"+s+"="+o.d,s++}return t+=i,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(s),i()})}addTag(e,t){(0,c.Yr)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||"loaded"===s||"complete"===s)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{J("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}let Gn=null;typeof MozWebSocket<"u"?Gn=MozWebSocket:typeof WebSocket<"u"&&(Gn=WebSocket);let Lt=(()=>{class n{constructor(t,i,s,r,o,a,l){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Et(this.connId),this.stats_=M(i),this.connURL=n.connectionURL_(i,a,l,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,s,r,o){const a={v:"5"};return!(0,c.Yr)()&&typeof location<"u"&&location.hostname&&Wn.test(location.hostname)&&(a.r="f"),i&&(a.s=i),s&&(a.ls=s),r&&(a.ac=r),o&&(a.p=o),d(t,Un,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ke.set("previous_websocket_failure",!0);try{let s;if((0,c.Yr)()){s={headers:{"User-Agent":`Firebase/5/${Re}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);const o=process.env,a=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new Gn(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const s=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&null!==Gn&&!n.forceDisallow_}static previouslyFailed(){return Ke.isInMemoryStorage||!0===Ke.get("previous_websocket_failure")}markConnectionHealthy(){Ke.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const s=(0,c.cI)(i);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if((0,c.hu)(null===this.frames,"We already have a frame buffer"),t.length<=6){const i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(i);else{const s=this.extractFrameCount_(i);null!==s&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();const i=(0,c.Wl)(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const s=Zt(i,16384);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),Ms=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[at,Lt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const i=Lt&&Lt.isAvailable();let s=i&&!Lt.previouslyFailed();if(t.webSocketOnly&&(i||ne("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Lt];else{const r=this.transports_=[];for(const o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class Gs{constructor(e,t,i,s,r,o,a,l,u,_){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=_,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Et("c:"+this.id+":"),this.transportManager_=new Ms(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=rt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=te("t",e),i=te("d",e);if("c"===t)this.onSecondaryControl_(i);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=te("t",e),i=te("d",e);"c"===t?this.onControl_(i):"d"===t&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=te("t",e);if("d"in e){const i=e.d;if("h"===t){const s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(i):"r"===t?this.onReset_(i):"e"===t?Qt("Server Error: "+i):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Qt("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==i&&ne("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),rt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):rt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ke.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Hs{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class js{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,c.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context))return void s.splice(r,1)}validateEventType_(e){(0,c.hu)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Hn extends js{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!(0,c.uI)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Hn}getInitialEvent(e){return(0,c.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class B{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function L(){return new B("")}function R(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function lt(n){return n.pieces_.length-n.pieceNum_}function V(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new B(n.pieces_,e)}function Pi(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function sn(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Ks(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new B(e,0)}function z(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof B)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new B(t,0)}function k(n){return n.pieceNum_>=n.pieces_.length}function de(n,e){const t=R(n),i=R(e);if(null===t)return e;if(t===i)return de(V(n),V(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function ca(n,e){const t=sn(n,0),i=sn(e,0);for(let s=0;s<t.length&&s<i.length;s++){const r=Pe(t[s],i[s]);if(0!==r)return r}return t.length===i.length?0:t.length<i.length?-1:1}function xi(n,e){if(lt(n)!==lt(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function be(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(lt(n)>lt(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class ua{constructor(e,t){this.errorPrefix_=t,this.parts_=sn(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=(0,c.ug)(this.parts_[i]);Qs(this)}}function Qs(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+wt(n))}function wt(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class Di extends js{constructor(){let e,t;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new Di}getInitialEvent(e){return(0,c.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const rn=1e3;let Yn,It=(()=>{class n extends Hs{constructor(t,i,s,r,o,a,l,u){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=u,this.id=n.nextPersistentConnectionId_++,this.log_=Et("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=rn,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!(0,c.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Di.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Hn.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,s){const r=++this.requestNumber_,o={r,a:t,b:i};this.log_((0,c.Wl)(o)),(0,c.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();const i=new c.BH,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{const l=a.d;"ok"===a.s?i.resolve(l):i.reject(l)}};return this.outstandingGets_.push(r),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),i.promise}listen(t,i,s,r){this.initConnection_();const o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),(0,c.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,c.hu)(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");const l={onComplete:r,hashFn:i,query:t,tag:s};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){const i=this.outstandingGets_[t];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(t){const i=t.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);const o={p:s};t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,l=>{const u=l.d,_=l.s;n.warnOnListenWarnings_(u,i),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",l),"ok"!==_&&this.removeListen_(s,r),t.onComplete&&t.onComplete(_,u))})}static warnOnListenWarnings_(t,i){if(t&&"object"==typeof t&&(0,c.r3)(t,"w")){const s=(0,c.DV)(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();ne(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||(0,c.GJ)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,i=(0,c.w9)(t)?"auth":"gauth",s={cred:t};null===this.authOverride_?s.noauth=!0:"object"==typeof this.authOverride_&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{const o=r.s,a=r.d||"error";this.authToken_===t&&("ok"===o?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const i=t.s,s=t.d||"error";"ok"===i?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(t,i){const s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),(0,c.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,i)}sendUnlisten_(t,i,s,r){this.log_("Unlisten on "+t+" for "+i);const o={p:t};r&&(o.q=s,o.t=r),this.sendRequest("n",o)}onDisconnectPut(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:s})}onDisconnectMerge(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:s})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,s,r){const o={p:i,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,i,s,r){this.putInternal("p",t,i,s,r)}merge(t,i,s,r){this.putInternal("m",t,i,s,r)}putInternal(t,i,s,r,o){this.initConnection_();const a={p:i,d:s};void 0!==o&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)}sendPut_(t){const i=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){const i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,s=>{"ok"!==s.s&&this.log_("reportStats","Error sending stats: "+s.d)})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+(0,c.Wl)(t));const i=t.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),"d"===t?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===t?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===t?this.onListenRevoked_(i.p,i.q):"ac"===t?this.onAuthRevoked_(i.s,i.d):"apc"===t?this.onAppCheckRevoked_(i.s,i.d):"sd"===t?this.onSecurityDebugPacket_(i):Qt("Unrecognized action received from server: "+(0,c.Wl)(t)+"\nAre you using the latest client?")}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){(0,c.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=rn,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=rn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=rn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return(0,b.Z)(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const i=t.onDataMessage_.bind(t),s=t.onReady_.bind(t),r=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+n.nextConnectionId_++,a=t.lastSessionId;let l=!1,u=null;const _=function(){u?u.close():(l=!0,r())};t.realtime_={close:_,sendRequest:function(w){(0,c.hu)(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(w)}};const v=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[w,I]=yield Promise.all([t.authTokenProvider_.getToken(v),t.appCheckTokenProvider_.getToken(v)]);l?J("getToken() completed but was canceled"):(J("getToken() completed. Creating connection."),t.authToken_=w&&w.accessToken,t.appCheckToken_=I&&I.token,u=new Gs(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,i,s,r,N=>{ne(N+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},a))}catch(w){t.log_("Failed to get token: "+w),l||(t.repoInfo_.nodeAdmin&&ne(w),_())}}})()}interrupt(t){J("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){J("Resuming connection for reason: "+t),delete this.interruptReasons_[t],(0,c.xb)(this.interruptReasons_)&&(this.reconnectDelay_=rn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const i=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let s;s=i?i.map(o=>Ze(o)).join("$"):"default";const r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,i){const s=new B(t).toString();let r;if(this.listens.has(s)){const o=this.listens.get(s);r=o.get(i),o.delete(i),0===o.size&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,i){J("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){J("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===t||"permission_denied"===t)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let i="js";(0,c.Yr)()&&(i=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+i+"."+Re.replace(/\./g,"-")]=1,(0,c.uI)()?t["framework.cordova"]=1:(0,c.b$)()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Hn.getInstance().currentlyOnline();return(0,c.xb)(this.interruptReasons_)&&t}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class D{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new D(e,t)}}class jn{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new D(ke,e),s=new D(ke,t);return 0!==this.compare(i,s)}minPost(){return D.MIN}}class Xs extends jn{static get __EMPTY_NODE(){return Yn}static set __EMPTY_NODE(e){Yn=e}compare(e,t){return Pe(e.name,t.name)}isDefinedOn(e){throw(0,c.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return D.MIN}maxPost(){return new D(Ne,Yn)}makePost(e,t){return(0,c.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new D(e,Yn)}toString(){return".key"}}const Ue=new Xs;class zn{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(o=t?i(e.key,t):1,s&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let Mi,xe=(()=>{class n{constructor(t,i,s,r,o){this.key=t,this.value=i,this.color=s??n.RED,this.left=r??pe.EMPTY_NODE,this.right=o??pe.EMPTY_NODE}copy(t,i,s,r,o){return new n(t??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,s){let r=this;const o=s(t,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(t,i,s),null):0===o?r.copy(null,i,null,null,null):r.copy(null,null,null,null,r.right.insert(t,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return pe.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let s,r;if(s=this,i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),0===i(t,s.key)){if(s.right.isEmpty())return pe.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class pe{constructor(e,t=pe.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new pe(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,xe.BLACK,null,null))}remove(e){return new pe(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,xe.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}t<0?i=i.left:t>0&&(s=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new zn(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new zn(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new zn(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new zn(this.root_,null,this.comparator_,!0,e)}}function va(n,e){return Pe(n.name,e.name)}function Oi(n,e){return Pe(n,e)}pe.EMPTY_NODE=new class ma{copy(e,t,i,s,r){return this}insert(e,t,i){return new xe(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Js=function(n){return"number"==typeof n?"number:"+Ot(n):"string:"+n},qs=function(n){if(n.isLeafNode()){const e=n.val();(0,c.hu)("string"==typeof e||"number"==typeof e||"object"==typeof e&&(0,c.r3)(e,".sv"),"Priority must be a string or number.")}else(0,c.hu)(n===Mi||n.isEmpty(),"priority of unexpected type.");(0,c.hu)(n===Mi||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let er,tr,nr,Wt=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,(0,c.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),qs(this.priorityNode_)}static set __childrenNodeConstructor(t){er=t}static get __childrenNodeConstructor(){return er}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return k(t)?this:".priority"===R(t)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return".priority"===t?this.updatePriority(i):i.isEmpty()&&".priority"!==t?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){const s=R(t);return null===s?i:i.isEmpty()&&".priority"!==s?this:((0,c.hu)(".priority"!==s||1===lt(t),".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(V(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Js(this.priorityNode_.val())+":");const i=typeof this.value_;t+=i+":",t+="number"===i?Ot(this.value_):this.value_,this.lazyHash_=xn(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:((0,c.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const i=typeof t.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return(0,c.hu)(r>=0,"Unknown leaf type: "+i),(0,c.hu)(o>=0,"Unknown leaf type: "+s),r===o?"object"===s?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){return t===this||!!t.isLeafNode()&&(this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_))}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const H=new class wa extends jn{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return 0===r?Pe(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return D.MIN}maxPost(){return new D(Ne,new Wt("[PRIORITY-POST]",nr))}makePost(e,t){const i=tr(e);return new D(t,new Wt("[PRIORITY-POST]",i))}toString(){return".priority"}},Ia=Math.log(2);class ba{constructor(e){this.count=parseInt(Math.log(e+1)/Ia,10),this.current_=this.count-1;const s=(r=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Kn=function(n,e,t,i){n.sort(e);const s=function(l,u){const _=u-l;let m,v;if(0===_)return null;if(1===_)return m=n[l],v=t?t(m):m,new xe(v,m.node,xe.BLACK,null,null);{const w=parseInt(_/2,10)+l,I=s(l,w),N=s(w+1,u);return m=n[w],v=t?t(m):m,new xe(v,m.node,xe.BLACK,I,N)}},a=function(l){let u=null,_=null,m=n.length;const v=function(I,N){const K=m-I,he=m;m-=I;const Ce=s(K+1,he),je=n[K],ee=t?t(je):je;w(new xe(ee,je.node,N,null,Ce))},w=function(I){u?(u.left=I,u=I):(_=I,u=I)};for(let I=0;I<l.count;++I){const N=l.nextBitIsOne(),K=Math.pow(2,l.count-(I+1));N?v(K,xe.BLACK):(v(K,xe.BLACK),v(K,xe.RED))}return _}(new ba(n.length));return new pe(i||e,a)};let Fi;const Bt={};class Je{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,c.hu)(Bt&&H,"ChildrenNode.ts has not been loaded"),Fi=Fi||new Je({".priority":Bt},{".priority":H}),Fi}get(e){const t=(0,c.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof pe?t:null}hasIndex(e){return(0,c.r3)(this.indexSet_,e.toString())}addIndex(e,t){(0,c.hu)(e!==Ue,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator(D.Wrap);let a,o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();a=s?Kn(i,e.getCompare()):Bt;const l=e.toString(),u=Object.assign({},this.indexSet_);u[l]=e;const _=Object.assign({},this.indexes_);return _[l]=a,new Je(_,u)}addToIndexes(e,t){const i=(0,c.UI)(this.indexes_,(s,r)=>{const o=(0,c.DV)(this.indexSet_,r);if((0,c.hu)(o,"Missing index implementation for "+r),s===Bt){if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(D.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),Kn(a,o.getCompare())}return Bt}{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new D(e.name,a))),l.insert(e,e.node)}});return new Je(i,this.indexSet_)}removeFromIndexes(e,t){const i=(0,c.UI)(this.indexes_,s=>{if(s===Bt)return s;{const r=t.get(e.name);return r?s.remove(new D(e.name,r)):s}});return new Je(i,this.indexSet_)}}let on,A=(()=>{class n{constructor(t,i,s){this.children_=t,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&qs(this.priorityNode_),this.children_.isEmpty()&&(0,c.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return on||(on=new n(new pe(Oi),null,Je.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||on}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const i=this.children_.get(t);return null===i?on:i}}getChild(t){const i=R(t);return null===i?this:this.getImmediateChild(i).getChild(V(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,i){if((0,c.hu)(i,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(i);{const s=new D(t,i);let r,o;i.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(s,this.children_));const a=r.isEmpty()?on:this.priorityNode_;return new n(r,a,o)}}updateChild(t,i){const s=R(t);if(null===s)return i;{(0,c.hu)(".priority"!==R(t)||1===lt(t),".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(V(t),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const i={};let s=0,r=0,o=!0;if(this.forEachChild(H,(a,l)=>{i[a]=l.val(t),s++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){const a=[];for(const l in i)a[l]=i[l];return a}return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+Js(this.getPriority().val())+":"),this.forEachChild(H,(i,s)=>{const r=s.hash();""!==r&&(t+=":"+i+":"+r)}),this.lazyHash_=""===t?"":xn(t)}return this.lazyHash_}getPredecessorChildName(t,i,s){const r=this.resolveIndex_(s);if(r){const o=r.getPredecessorKey(new D(t,i));return o?o.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const i=this.resolveIndex_(t);if(i){const s=i.minKey();return s&&s.name}return this.children_.minKey()}getFirstChild(t){const i=this.getFirstChildName(t);return i?new D(i,this.children_.get(i)):null}getLastChildName(t){const i=this.resolveIndex_(t);if(i){const s=i.maxKey();return s&&s.name}return this.children_.maxKey()}getLastChild(t){const i=this.getLastChildName(t);return i?new D(i,this.children_.get(i)):null}forEachChild(t,i){const s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){const s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(t,r=>r);{const r=this.children_.getIteratorFrom(t.name,D.Wrap);let o=r.peek();for(;null!=o&&i.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){const s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(t,r=>r);{const r=this.children_.getReverseIteratorFrom(t.name,D.Wrap);let o=r.peek();for(;null!=o&&i.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===an?-1:0}withIndex(t){if(t===Ue||this.indexMap_.hasIndex(t))return this;{const i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===Ue||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const i=t;if(this.getPriority().equals(i.getPriority())){if(this.children_.count()===i.children_.count()){const s=this.getIterator(H),r=i.getIterator(H);let o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return null===o&&null===a}return!1}return!1}}resolveIndex_(t){return t===Ue?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const an=new class Sa extends A{constructor(){super(new pe(Oi),A.EMPTY_NODE,Je.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return A.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(D,{MIN:{value:new D(ke,A.EMPTY_NODE)},MAX:{value:new D(Ne,an)}}),Xs.__EMPTY_NODE=A.EMPTY_NODE,Wt.__childrenNodeConstructor=A,function ya(n){Mi=n}(an),function Ea(n){nr=n}(an);const Ta=!0;function Z(n,e=null){if(null===n)return A.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(e=n[".priority"]),(0,c.hu)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new Wt(n,Z(e));if(n instanceof Array||!Ta){let t=A.EMPTY_NODE;return q(n,(i,s)=>{if((0,c.r3)(n,i)&&"."!==i.substring(0,1)){const r=Z(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(Z(e))}{const t=[];let i=!1;if(q(n,(o,a)=>{if("."!==o.substring(0,1)){const l=Z(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new D(o,l)))}}),0===t.length)return A.EMPTY_NODE;const r=Kn(t,va,o=>o.name,Oi);if(i){const o=Kn(t,H.getCompare());return new A(r,Z(e),new Je({".priority":o},{".priority":H}))}return new A(r,Z(e),Je.Default)}}!function Ca(n){tr=n}(Z);class Li extends jn{constructor(e){super(),this.indexPath_=e,(0,c.hu)(!k(e)&&".priority"!==R(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return 0===r?Pe(e.name,t.name):r}makePost(e,t){const i=Z(e),s=A.EMPTY_NODE.updateChild(this.indexPath_,i);return new D(t,s)}maxPost(){const e=A.EMPTY_NODE.updateChild(this.indexPath_,an);return new D(Ne,e)}toString(){return sn(this.indexPath_,0).join("/")}}const Wi=new class Aa extends jn{compare(e,t){const i=e.node.compareTo(t.node);return 0===i?Pe(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return D.MIN}maxPost(){return D.MAX}makePost(e,t){const i=Z(e);return new D(t,i)}toString(){return".value"}};function ir(n){return{type:"value",snapshotNode:n}}function Ut(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ln(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function cn(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}class Bi{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){(0,c.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(null!=o&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(ln(t,a)):(0,c.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ut(t,i)):o.trackChildChange(cn(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return null!=i&&(e.isLeafNode()||e.forEachChild(H,(s,r)=>{t.hasChild(s)||i.trackChildChange(ln(s,r))}),t.isLeafNode()||t.forEachChild(H,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(cn(s,r,o))}else i.trackChildChange(Ut(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?A.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class un{constructor(e){this.indexedFilter_=new Bi(e.getIndex()),this.index_=e.getIndex(),this.startPost_=un.getStartPost_(e),this.endPost_=un.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new D(t,i))||(i=A.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=A.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(A.EMPTY_NODE);const r=this;return t.forEachChild(H,(o,a)=>{r.matches(new D(o,a))||(s=s.updateImmediateChild(o,A.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class ka{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{const i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new un(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new D(t,i))||(i=A.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=A.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let r;s=A.EMPTY_NODE.withIndex(this.index_),r=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a)){if(!this.withinDirectionalEnd(a))break;s=s.updateImmediateChild(a.name,a.node),o++}}}else{let r;s=t.withIndex(this.index_),s=s.updatePriority(A.EMPTY_NODE),r=this.reverse_?s.getReverseIterator(this.index_):s.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,A.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){const m=this.index_.getCompare();o=(v,w)=>m(w,v)}else o=this.index_.getCompare();const a=e;(0,c.hu)(a.numChildren()===this.limit_,"");const l=new D(t,i),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),_=this.rangedFilter_.matches(l);if(a.hasChild(t)){const m=a.getImmediateChild(t);let v=s.getChildAfterChild(this.index_,u,this.reverse_);for(;null!=v&&(v.name===t||a.hasChild(v.name));)v=s.getChildAfterChild(this.index_,v,this.reverse_);const w=null==v?1:o(v,l);if(_&&!i.isEmpty()&&w>=0)return r?.trackChildChange(cn(t,i,m)),a.updateImmediateChild(t,i);{r?.trackChildChange(ln(t,m));const N=a.updateImmediateChild(t,A.EMPTY_NODE);return null!=v&&this.rangedFilter_.matches(v)?(r?.trackChildChange(Ut(v.name,v.node)),N.updateImmediateChild(v.name,v.node)):N}}return i.isEmpty()?e:_&&o(u,l)>=0?(null!=r&&(r.trackChildChange(ln(u.name,u.node)),r.trackChildChange(Ut(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(u.name,A.EMPTY_NODE)):e}}class Qn{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=H}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,c.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,c.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ke}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,c.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,c.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ne}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,c.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===H}copy(){const e=new Qn;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Ui(n,e,t){const i=n.copy();return i.startSet_=!0,void 0===e&&(e=null),i.indexStartValue_=e,null!=t?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Vi(n,e,t){const i=n.copy();return i.endSet_=!0,void 0===e&&(e=null),i.indexEndValue_=e,void 0!==t?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function $n(n,e){const t=n.copy();return t.index_=e,t}function sr(n){const e={};if(n.isDefault())return e;let t;if(n.index_===H?t="$priority":n.index_===Wi?t="$value":n.index_===Ue?t="$key":((0,c.hu)(n.index_ instanceof Li,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=(0,c.Wl)(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=(0,c.Wl)(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+(0,c.Wl)(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=(0,c.Wl)(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+(0,c.Wl)(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function rr(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;""===t&&(t=n.isViewFromLeft()?"l":"r"),e.vf=t}return n.index_!==H&&(e.i=n.index_.toString()),e}class Zn extends Hs{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Et("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,c.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Zn.getListenId_(e,i),a={};this.listens_[o]=a;const l=sr(e._queryParams);this.restRequest_(r+".json",l,(u,_)=>{let m=_;if(404===u&&(m=null,u=null),null===u&&this.onDataUpdate_(r,m,!1,i),(0,c.DV)(this.listens_,o)===a){let v;v=u?401===u?"permission_denied":"rest_error:"+u:"ok",s(v,null)}})}unlisten(e,t){const i=Zn.getListenId_(e,t);delete this.listens_[i]}get(e){const t=sr(e._queryParams),i=e._path.toString(),s=new c.BH;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;404===r&&(a=null,r=null),null===r?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,c.xO)(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=(0,c.cI)(a.responseText)}catch{ne("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else 401!==a.status&&404!==a.status&&ne("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}class Ma{constructor(){this.rootNode_=A.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Xn(){return{value:null,children:new Map}}function Vt(n,e,t){if(k(e))n.value=t,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(e,t);else{const i=R(e);n.children.has(i)||n.children.set(i,Xn()),Vt(n.children.get(i),e=V(e),t)}}function Gi(n,e){if(k(e))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(H,(i,s)=>{Vt(n,new B(i),s)}),Gi(n,e)}}if(n.children.size>0){const t=R(e);return e=V(e),n.children.has(t)&&Gi(n.children.get(t),e)&&n.children.delete(t),0===n.children.size}return!0}function Hi(n,e,t){null!==n.value?t(e,n.value):function Fa(n,e){n.children.forEach((t,i)=>{e(i,t)})}(n,(i,s)=>{Hi(s,new B(e.toString()+"/"+i),t)})}class La{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&q(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}class Ua{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new La(e);const i=1e4+2e4*Math.random();rt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;q(e,(s,r)=>{r>0&&(0,c.r3)(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),rt(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Ve=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Ve||{});function zi(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Jn{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Ve.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(k(this.path)){if(null!=this.affectedTree.value)return(0,c.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new B(e));return new Jn(L(),t,this.revert)}}return(0,c.hu)(R(this.path)===e,"operationForChild called for unrelated child."),new Jn(V(this.path),this.affectedTree,this.revert)}}class dn{constructor(e,t){this.source=e,this.path=t,this.type=Ve.LISTEN_COMPLETE}operationForChild(e){return k(this.path)?new dn(this.source,L()):new dn(this.source,V(this.path))}}class bt{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Ve.OVERWRITE}operationForChild(e){return k(this.path)?new bt(this.source,L(),this.snap.getImmediateChild(e)):new bt(this.source,V(this.path),this.snap)}}class Gt{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Ve.MERGE}operationForChild(e){if(k(this.path)){const t=this.children.subtree(new B(e));return t.isEmpty()?null:t.value?new bt(this.source,L(),t.value):new Gt(this.source,L(),t)}return(0,c.hu)(R(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Gt(this.source,V(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ct{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(k(e))return this.isFullyInitialized()&&!this.filtered_;const t=R(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Va{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function hn(n,e,t,i,s,r){const o=i.filter(a=>a.type===t);o.sort((a,l)=>function ja(n,e,t){if(null==e.childName||null==t.childName)throw(0,c.g5)("Should only compare child_ events.");const i=new D(e.childName,e.snapshotNode),s=new D(t.childName,t.snapshotNode);return n.index_.compare(i,s)}(n,a,l)),o.forEach(a=>{const l=function Ha(n,e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}(n,a,r);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function qn(n,e){return{eventCache:n,serverCache:e}}function fn(n,e,t,i){return qn(new ct(e,t,i),n.serverCache)}function ar(n,e,t,i){return qn(n.eventCache,new ct(e,t,i))}function ei(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function St(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Ki;class j{constructor(e,t=(()=>(Ki||(Ki=new pe(Si)),Ki))()){this.value=e,this.children=t}static fromObject(e){let t=new j(null);return q(e,(i,s)=>{t=t.set(new B(i),s)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:L(),value:this.value};if(k(e))return null;{const i=R(e),s=this.children.get(i);if(null!==s){const r=s.findRootMostMatchingPathAndValue(V(e),t);return null!=r?{path:z(new B(i),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(k(e))return this;{const t=R(e),i=this.children.get(t);return null!==i?i.subtree(V(e)):new j(null)}}set(e,t){if(k(e))return new j(t,this.children);{const i=R(e),r=(this.children.get(i)||new j(null)).set(V(e),t),o=this.children.insert(i,r);return new j(this.value,o)}}remove(e){if(k(e))return this.children.isEmpty()?new j(null):new j(null,this.children);{const t=R(e),i=this.children.get(t);if(i){const s=i.remove(V(e));let r;return r=s.isEmpty()?this.children.remove(t):this.children.insert(t,s),null===this.value&&r.isEmpty()?new j(null):new j(this.value,r)}return this}}get(e){if(k(e))return this.value;{const t=R(e),i=this.children.get(t);return i?i.get(V(e)):null}}setTree(e,t){if(k(e))return t;{const i=R(e),r=(this.children.get(i)||new j(null)).setTree(V(e),t);let o;return o=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new j(this.value,o)}}fold(e){return this.fold_(L(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(z(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,L(),t)}findOnPath_(e,t,i){const s=!!this.value&&i(t,this.value);if(s)return s;if(k(e))return null;{const r=R(e),o=this.children.get(r);return o?o.findOnPath_(V(e),z(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,L(),t)}foreachOnPath_(e,t,i){if(k(e))return this;{this.value&&i(t,this.value);const s=R(e),r=this.children.get(s);return r?r.foreachOnPath_(V(e),z(t,s),i):new j(null)}}foreach(e){this.foreach_(L(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(z(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class De{constructor(e){this.writeTree_=e}static empty(){return new De(new j(null))}}function _n(n,e,t){if(k(e))return new De(new j(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(null!=i){const s=i.path;let r=i.value;const o=de(s,e);return r=r.updateChild(o,t),new De(n.writeTree_.set(s,r))}{const s=new j(t),r=n.writeTree_.setTree(e,s);return new De(r)}}}function Qi(n,e,t){let i=n;return q(t,(s,r)=>{i=_n(i,z(e,s),r)}),i}function lr(n,e){if(k(e))return De.empty();{const t=n.writeTree_.setTree(e,new j(null));return new De(t)}}function $i(n,e){return null!=Tt(n,e)}function Tt(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return null!=t?n.writeTree_.get(t.path).getChild(de(t.path,e)):null}function cr(n){const e=[],t=n.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(H,(i,s)=>{e.push(new D(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{null!=s.value&&e.push(new D(i,s.value))}),e}function ut(n,e){if(k(e))return n;{const t=Tt(n,e);return new De(null!=t?new j(t):n.writeTree_.subtree(e))}}function Zi(n){return n.writeTree_.isEmpty()}function Ht(n,e){return ur(L(),n.writeTree_,e)}function ur(n,e,t){if(null!=e.value)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{".priority"===s?((0,c.hu)(null!==r.value,"Priority writes must always be leaf nodes"),i=r.value):t=ur(z(n,s),r,t)}),!t.getChild(n).isEmpty()&&null!==i&&(t=t.updateChild(z(n,".priority"),i)),t}}function ti(n,e){return pr(e,n)}function Za(n,e){if(n.snap)return be(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&be(z(n.path,t),e))return!0;return!1}function Ja(n){return n.visible}function dr(n,e,t){let i=De.empty();for(let s=0;s<n.length;++s){const r=n[s];if(e(r)){const o=r.path;let a;if(r.snap)be(t,o)?(a=de(t,o),i=_n(i,a,r.snap)):be(o,t)&&(a=de(o,t),i=_n(i,L(),r.snap.getChild(a)));else{if(!r.children)throw(0,c.g5)("WriteRecord should have .snap or .children");if(be(t,o))a=de(t,o),i=Qi(i,a,r.children);else if(be(o,t))if(a=de(o,t),k(a))i=Qi(i,L(),r.children);else{const l=(0,c.DV)(r.children,R(a));if(l){const u=l.getChild(V(a));i=_n(i,L(),u)}}}}}return i}function hr(n,e,t,i,s){if(i||s){const r=ut(n.visibleWrites,e);return!s&&Zi(r)?t:s||null!=t||$i(r,L())?Ht(dr(n.allWrites,function(u){return(u.visible||s)&&(!i||!~i.indexOf(u.writeId))&&(be(u.path,e)||be(e,u.path))},e),t||A.EMPTY_NODE):null}{const r=Tt(n.visibleWrites,e);if(null!=r)return r;{const o=ut(n.visibleWrites,e);return Zi(o)?t:null!=t||$i(o,L())?Ht(o,t||A.EMPTY_NODE):null}}}function ni(n,e,t,i){return hr(n.writeTree,n.treePath,e,t,i)}function Xi(n,e){return function qa(n,e,t){let i=A.EMPTY_NODE;const s=Tt(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(H,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){const r=ut(n.visibleWrites,e);return t.forEachChild(H,(o,a)=>{const l=Ht(ut(r,new B(o)),a);i=i.updateImmediateChild(o,l)}),cr(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}return cr(ut(n.visibleWrites,e)).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}(n.writeTree,n.treePath,e)}function fr(n,e,t,i){return function el(n,e,t,i,s){(0,c.hu)(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=z(e,t);if($i(n.visibleWrites,r))return null;{const o=ut(n.visibleWrites,r);return Zi(o)?s.getChild(t):Ht(o,s.getChild(t))}}(n.writeTree,n.treePath,e,t,i)}function ii(n,e){return function nl(n,e){return Tt(n.visibleWrites,e)}(n.writeTree,z(n.treePath,e))}function Ji(n,e,t){return function tl(n,e,t,i){const s=z(e,t),r=Tt(n.visibleWrites,s);return null!=r?r:i.isCompleteForChild(t)?Ht(ut(n.visibleWrites,s),i.getNode().getImmediateChild(t)):null}(n.writeTree,n.treePath,e,t)}function _r(n,e){return pr(z(n.treePath,e),n.writeTree)}function pr(n,e){return{treePath:n,writeTree:e}}class ol{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;(0,c.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,c.hu)(".priority"!==i,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(i,cn(i,e.snapshotNode,s.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(i);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(i,ln(i,s.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(i,Ut(i,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw(0,c.g5)("Illegal combination of changes: "+e+" occurred after "+s);this.changeMap.set(i,cn(i,e.snapshotNode,s.oldSnap))}}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}const gr=new class al{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}};class qi{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=null!=this.optCompleteServerCache_?new ct(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ji(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:St(this.viewCache_),r=function rl(n,e,t,i,s,r){return function il(n,e,t,i,s,r,o){let a;const l=ut(n.visibleWrites,e),u=Tt(l,L());if(null!=u)a=u;else{if(null==t)return[];a=Ht(l,t)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const _=[],m=o.getCompare(),v=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let w=v.getNext();for(;w&&_.length<s;)0!==m(w,i)&&_.push(w),w=v.getNext();return _}}(n.writeTree,n.treePath,e,t,i,s,r)}(this.writes_,s,t,1,i,e);return 0===r.length?null:r[0]}}function mr(n,e,t,i,s,r){const o=e.eventCache;if(null!=ii(i,t))return e;{let a,l;if(k(t))if((0,c.hu)(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=St(e),m=Xi(i,u instanceof A?u:A.EMPTY_NODE);a=n.filter.updateFullNode(e.eventCache.getNode(),m,r)}else{const u=ni(i,St(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{const u=R(t);if(".priority"===u){(0,c.hu)(1===lt(t),"Can't have a priority with additional path components");const _=o.getNode();l=e.serverCache.getNode();const m=fr(i,t,_,l);a=null!=m?n.filter.updatePriority(_,m):o.getNode()}else{const _=V(t);let m;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const v=fr(i,t,o.getNode(),l);m=null!=v?o.getNode().getImmediateChild(u).updateChild(_,v):o.getNode().getImmediateChild(u)}else m=Ji(i,u,e.serverCache);a=null!=m?n.filter.updateChild(o.getNode(),u,m,_,s,r):o.getNode()}}return fn(e,a,o.isFullyInitialized()||k(t),n.filter.filtersNodes())}}function si(n,e,t,i,s,r,o,a){const l=e.serverCache;let u;const _=o?n.filter:n.filter.getIndexedFilter();if(k(t))u=_.updateFullNode(l.getNode(),i,null);else if(_.filtersNodes()&&!l.isFiltered()){const w=l.getNode().updateChild(t,i);u=_.updateFullNode(l.getNode(),w,null)}else{const w=R(t);if(!l.isCompleteForPath(t)&&lt(t)>1)return e;const I=V(t),K=l.getNode().getImmediateChild(w).updateChild(I,i);u=".priority"===w?_.updatePriority(l.getNode(),K):_.updateChild(l.getNode(),w,K,I,gr,null)}const m=ar(e,u,l.isFullyInitialized()||k(t),_.filtersNodes());return mr(n,m,t,s,new qi(s,m,r),a)}function es(n,e,t,i,s,r,o){const a=e.eventCache;let l,u;const _=new qi(s,e,r);if(k(t))u=n.filter.updateFullNode(e.eventCache.getNode(),i,o),l=fn(e,u,!0,n.filter.filtersNodes());else{const m=R(t);if(".priority"===m)u=n.filter.updatePriority(e.eventCache.getNode(),i),l=fn(e,u,a.isFullyInitialized(),a.isFiltered());else{const v=V(t),w=a.getNode().getImmediateChild(m);let I;if(k(v))I=i;else{const N=_.getCompleteChild(m);I=null!=N?".priority"===Pi(v)&&N.getChild(Ks(v)).isEmpty()?N:N.updateChild(v,i):A.EMPTY_NODE}l=w.equals(I)?e:fn(e,n.filter.updateChild(a.getNode(),m,I,v,_,o),a.isFullyInitialized(),n.filter.filtersNodes())}}return l}function vr(n,e){return n.eventCache.isCompleteForChild(e)}function yr(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function ts(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u,l=e;u=k(t)?i:new j(null).setTree(t,i);const _=e.serverCache.getNode();return u.children.inorderTraversal((m,v)=>{if(_.hasChild(m)){const I=yr(0,e.serverCache.getNode().getImmediateChild(m),v);l=si(n,l,new B(m),I,s,r,o,a)}}),u.children.inorderTraversal((m,v)=>{const w=!e.serverCache.isCompleteForChild(m)&&null===v.value;if(!_.hasChild(m)&&!w){const N=yr(0,e.serverCache.getNode().getImmediateChild(m),v);l=si(n,l,new B(m),N,s,r,o,a)}}),l}class gl{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new Bi(i.getIndex()),r=function Na(n){return n.loadsAllData()?new Bi(n.getIndex()):n.hasLimit()?new ka(n):new un(n)}(i);this.processor_=function ll(n){return{filter:n}}(r);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(A.EMPTY_NODE,o.getNode(),null),u=r.updateFullNode(A.EMPTY_NODE,a.getNode(),null),_=new ct(l,o.isFullyInitialized(),s.filtersNodes()),m=new ct(u,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=qn(m,_),this.eventGenerator_=new Va(this.query_)}get query(){return this.query_}}function yl(n,e){const t=St(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!k(e)&&!t.getImmediateChild(R(e)).isEmpty())?t.getChild(e):null}function Cr(n){return 0===n.eventRegistrations_.length}function Er(n,e,t){const i=[];if(t){(0,c.hu)(null==e,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(o.matches(e)){if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}else s.push(o)}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function wr(n,e,t,i){e.type===Ve.MERGE&&null!==e.source.queryId&&((0,c.hu)(St(n.viewCache_),"We should always have a full cache before handling merges"),(0,c.hu)(ei(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=function ul(n,e,t,i,s){const r=new ol;let o,a;if(t.type===Ve.OVERWRITE){const u=t;u.source.fromUser?o=es(n,e,u.path,u.snap,i,s,r):((0,c.hu)(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!k(u.path),o=si(n,e,u.path,u.snap,i,s,a,r))}else if(t.type===Ve.MERGE){const u=t;u.source.fromUser?o=function hl(n,e,t,i,s,r,o){let a=e;return i.foreach((l,u)=>{const _=z(t,l);vr(e,R(_))&&(a=es(n,a,_,u,s,r,o))}),i.foreach((l,u)=>{const _=z(t,l);vr(e,R(_))||(a=es(n,a,_,u,s,r,o))}),a}(n,e,u.path,u.children,i,s,r):((0,c.hu)(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=ts(n,e,u.path,u.children,i,s,a,r))}else if(t.type===Ve.ACK_USER_WRITE){const u=t;o=u.revert?function pl(n,e,t,i,s,r){let o;if(null!=ii(i,t))return e;{const a=new qi(i,e,s),l=e.eventCache.getNode();let u;if(k(t)||".priority"===R(t)){let _;if(e.serverCache.isFullyInitialized())_=ni(i,St(e));else{const m=e.serverCache.getNode();(0,c.hu)(m instanceof A,"serverChildren would be complete if leaf node"),_=Xi(i,m)}u=n.filter.updateFullNode(l,_,r)}else{const _=R(t);let m=Ji(i,_,e.serverCache);null==m&&e.serverCache.isCompleteForChild(_)&&(m=l.getImmediateChild(_)),u=null!=m?n.filter.updateChild(l,_,m,V(t),a,r):e.eventCache.getNode().hasChild(_)?n.filter.updateChild(l,_,A.EMPTY_NODE,V(t),a,r):l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=ni(i,St(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,r)))}return o=e.serverCache.isFullyInitialized()||null!=ii(i,L()),fn(e,u,o,n.filter.filtersNodes())}}(n,e,u.path,i,s,r):function fl(n,e,t,i,s,r,o){if(null!=ii(s,t))return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(null!=i.value){if(k(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return si(n,e,t,l.getNode().getChild(t),s,r,a,o);if(k(t)){let u=new j(null);return l.getNode().forEachChild(Ue,(_,m)=>{u=u.set(new B(_),m)}),ts(n,e,t,u,s,r,a,o)}return e}{let u=new j(null);return i.foreach((_,m)=>{const v=z(t,_);l.isCompleteForPath(v)&&(u=u.set(_,l.getNode().getChild(v)))}),ts(n,e,t,u,s,r,a,o)}}(n,e,u.path,u.affectedTree,i,s,r)}else{if(t.type!==Ve.LISTEN_COMPLETE)throw(0,c.g5)("Unknown operation type: "+t.type);o=function _l(n,e,t,i,s){const r=e.serverCache;return mr(n,ar(e,r.getNode(),r.isFullyInitialized()||k(t),r.isFiltered()),t,i,gr,s)}(n,e,t.path,i,r)}const l=r.getChanges();return function dl(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=ei(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(ir(ei(e)))}}(e,o,l),{viewCache:o,changes:l}}(n.processor_,s,e,t,i);return function cl(n,e){(0,c.hu)(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),(0,c.hu)(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,r.viewCache),(0,c.hu)(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Ir(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Ir(n,e,t,i){return function Ga(n,e,t,i){const s=[],r=[];return e.forEach(o=>{"child_changed"===o.type&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(function Ra(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}(o.childName,o.snapshotNode))}),hn(n,s,"child_removed",e,i,t),hn(n,s,"child_added",e,i,t),hn(n,s,"child_moved",r,i,t),hn(n,s,"child_changed",e,i,t),hn(n,s,"value",e,i,t),s}(n.eventGenerator_,e,t,i?[i]:n.eventRegistrations_)}let ri,ai;class br{constructor(){this.views=new Map}}function ns(n,e,t,i){const s=e.source.queryId;if(null!==s){const r=n.views.get(s);return(0,c.hu)(null!=r,"SyncTree gave us an op for an invalid query."),wr(r,e,t,i)}{let r=[];for(const o of n.views.values())r=r.concat(wr(o,e,t,i));return r}}function Sr(n,e,t,i,s){const o=n.views.get(e._queryIdentifier);if(!o){let a=ni(t,s?i:null),l=!1;a?l=!0:i instanceof A?(a=Xi(t,i),l=!1):(a=A.EMPTY_NODE,l=!1);const u=qn(new ct(a,l,!1),new ct(i,s,!1));return new gl(e,u)}return o}function Tr(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function dt(n,e){let t=null;for(const i of n.views.values())t=t||yl(i,e);return t}function Ar(n,e){return e._queryParams.loadsAllData()?oi(n):n.views.get(e._queryIdentifier)}function Rr(n,e){return null!=Ar(n,e)}function ht(n){return null!=oi(n)}function oi(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let kl=1;class kr{constructor(e){this.listenProvider_=e,this.syncPointTree_=new j(null),this.pendingWriteTree_=function sl(){return{visibleWrites:De.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function is(n,e,t,i,s){return function za(n,e,t,i,s){(0,c.hu)(i>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=_n(n.visibleWrites,e,t)),n.lastWriteId=i}(n.pendingWriteTree_,e,t,i,s),s?jt(n,new bt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,t)):[]}function ft(n,e,t=!1){const i=function Qa(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}(n.pendingWriteTree_,e);if(function $a(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);(0,c.hu)(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&Za(a,i.path)?s=!1:be(i.path,a.path)&&(r=!0)),o--}return!!s&&(r?(function Xa(n){n.visibleWrites=dr(n.allWrites,Ja,L()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(i.snap?n.visibleWrites=lr(n.visibleWrites,i.path):q(i.children,l=>{n.visibleWrites=lr(n.visibleWrites,z(i.path,l))}),!0))}(n.pendingWriteTree_,e)){let r=new j(null);return null!=i.snap?r=r.set(L(),!0):q(i.children,o=>{r=r.set(new B(o),!0)}),jt(n,new Jn(i.path,r,t))}return[]}function pn(n,e,t){return jt(n,new bt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,t))}function li(n,e,t,i,s=!1){const r=e._path,o=n.syncPointTree_.get(r);let a=[];if(o&&("default"===e._queryIdentifier||Rr(o,e))){const l=function Tl(n,e,t,i){const s=e._queryIdentifier,r=[];let o=[];const a=ht(n);if("default"===s)for(const[l,u]of n.views.entries())o=o.concat(Er(u,t,i)),Cr(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||r.push(u.query));else{const l=n.views.get(s);l&&(o=o.concat(Er(l,t,i)),Cr(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!ht(n)&&r.push(new(function Il(){return(0,c.hu)(ri,"Reference.ts has not been loaded"),ri}())(e._repo,e._path)),{removed:r,events:o}}(o,e,t,i);(function bl(n){return 0===n.views.size})(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const u=l.removed;if(a=l.events,!s){const _=-1!==u.findIndex(v=>v._queryParams.loadsAllData()),m=n.syncPointTree_.findOnPath(r,(v,w)=>ht(w));if(_&&!m){const v=n.syncPointTree_.subtree(r);if(!v.isEmpty()){const w=function Fl(n){return n.fold((e,t,i)=>{if(t&&ht(t))return[oi(t)];{let s=[];return t&&(s=Tr(t)),q(i,(r,o)=>{s=s.concat(o)}),s}})}(v);for(let I=0;I<w.length;++I){const N=w[I],K=N.query,he=Dr(n,N);n.listenProvider_.startListening(mn(K),gn(n,K),he.hashFn,he.onComplete)}}}!m&&u.length>0&&!i&&(_?n.listenProvider_.stopListening(mn(e),null):u.forEach(v=>{const w=n.queryToTagMap.get(ui(v));n.listenProvider_.stopListening(mn(v),w)}))}!function Ll(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=ui(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}(n,u)}return a}function Nr(n,e,t,i){const s=rs(n,i);if(null!=s){const r=os(s),o=r.path,a=r.queryId,l=de(o,e);return as(n,o,new bt(zi(a),l,t))}return[]}function ss(n,e,t,i=!1){const s=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(v,w)=>{const I=de(v,s);r=r||dt(w,I),o=o||ht(w)});let l,a=n.syncPointTree_.get(s);a?(o=o||ht(a),r=r||dt(a,L())):(a=new br,n.syncPointTree_=n.syncPointTree_.set(s,a)),null!=r?l=!0:(l=!1,r=A.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((w,I)=>{const N=dt(I,L());N&&(r=r.updateImmediateChild(w,N))}));const u=Rr(a,e);if(!u&&!e._queryParams.loadsAllData()){const v=ui(e);(0,c.hu)(!n.queryToTagMap.has(v),"View does not exist, but we have a tag");const w=function Wl(){return kl++}();n.queryToTagMap.set(v,w),n.tagToQueryMap.set(w,v)}let m=function Sl(n,e,t,i,s,r){const o=Sr(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),function Cl(n,e){n.eventRegistrations_.push(e)}(o,t),function El(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(H,(r,o)=>{i.push(Ut(r,o))}),t.isFullyInitialized()&&i.push(ir(t.getNode())),Ir(n,i,t.getNode(),e)}(o,t)}(a,e,t,ti(n.pendingWriteTree_,s),r,l);if(!u&&!o&&!i){const v=Ar(a,e);m=m.concat(function Bl(n,e,t){const i=e._path,s=gn(n,e),r=Dr(n,t),o=n.listenProvider_.startListening(mn(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)(0,c.hu)(!ht(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,_,m)=>{if(!k(u)&&_&&ht(_))return[oi(_).query];{let v=[];return _&&(v=v.concat(Tr(_).map(w=>w.query))),q(m,(w,I)=>{v=v.concat(I)}),v}});for(let u=0;u<l.length;++u){const _=l[u];n.listenProvider_.stopListening(mn(_),gn(n,_))}}return o}(n,e,v))}return m}function ci(n,e,t){const s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const u=dt(a,de(o,e));if(u)return u});return hr(s,e,r,t,!0)}function jt(n,e){return Pr(e,n.syncPointTree_,null,ti(n.pendingWriteTree_,L()))}function Pr(n,e,t,i){if(k(n.path))return xr(n,e,t,i);{const s=e.get(L());null==t&&null!=s&&(t=dt(s,L()));let r=[];const o=R(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,_=_r(i,o);r=r.concat(Pr(a,l,u,_))}return s&&(r=r.concat(ns(s,n,i,t))),r}}function xr(n,e,t,i){const s=e.get(L());null==t&&null!=s&&(t=dt(s,L()));let r=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=_r(i,o),_=n.operationForChild(o);_&&(r=r.concat(xr(_,a,l,u)))}),s&&(r=r.concat(ns(s,n,i,t))),r}function Dr(n,e){const t=e.query,i=gn(n,t);return{hashFn:()=>(function ml(n){return n.viewCache_.serverCache.getNode()}(e)||A.EMPTY_NODE).hash(),onComplete:s=>{if("ok"===s)return i?function Dl(n,e,t){const i=rs(n,t);if(i){const s=os(i),r=s.path,o=s.queryId,a=de(r,e);return as(n,r,new dn(zi(o),a))}return[]}(n,t._path,i):function xl(n,e){return jt(n,new dn({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(n,t._path);{const r=function Mn(n,e){let t="Unknown Error";"too_big"===n?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?t="Client doesn't have permission to access the desired data.":"unavailable"===n&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}(s,t);return li(n,t,null,r)}}}}function gn(n,e){const t=ui(e);return n.queryToTagMap.get(t)}function ui(n){return n._path.toString()+"$"+n._queryIdentifier}function rs(n,e){return n.tagToQueryMap.get(e)}function os(n){const e=n.indexOf("$");return(0,c.hu)(-1!==e&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new B(n.substr(0,e))}}function as(n,e,t){const i=n.syncPointTree_.get(e);return(0,c.hu)(i,"Missing sync point for query tag that we're tracking"),ns(i,t,ti(n.pendingWriteTree_,e),null)}function mn(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function Rl(){return(0,c.hu)(ai,"Reference.ts has not been loaded"),ai}())(n._repo,n._path):n}class ls{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ls(t)}node(){return this.node_}}class cs{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=z(this.path_,e);return new cs(this.syncTree_,t)}node(){return ci(this.syncTree_,this.path_)}}const Ul=function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n},Or=function(n,e,t){return n&&"object"==typeof n?((0,c.hu)(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?Vl(n[".sv"],e,t):"object"==typeof n[".sv"]?Gl(n[".sv"],e):void(0,c.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},Vl=function(n,e,t){if("timestamp"===n)return t.timestamp;(0,c.hu)(!1,"Unexpected server value: "+n)},Gl=function(n,e,t){n.hasOwnProperty("increment")||(0,c.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;"number"!=typeof i&&(0,c.hu)(!1,"Unexpected increment value: "+i);const s=e.node();if((0,c.hu)(null!==s&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return"number"!=typeof o?i:o+i},Mr=function(n,e,t,i){return ds(e,new cs(t,n),i)},us=function(n,e,t){return ds(n,new ls(e),t)};function ds(n,e,t){const i=n.getPriority().val(),s=Or(i,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=Or(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Wt(a,Z(s)):n}{const o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Wt(s))),o.forEachChild(H,(a,l)=>{const u=ds(l,e.getImmediateChild(a),t);u!==l&&(r=r.updateImmediateChild(a,u))}),r}}class hs{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function di(n,e){let t=e instanceof B?e:new B(e),i=n,s=R(t);for(;null!==s;){const r=(0,c.DV)(i.node.children,s)||{children:{},childCount:0};i=new hs(s,i,r),t=V(t),s=R(t)}return i}function At(n){return n.node.value}function fs(n,e){n.node.value=e,_s(n)}function Fr(n){return n.node.childCount>0}function hi(n,e){q(n.node.children,(t,i)=>{e(new hs(t,n,i))})}function Lr(n,e,t,i){t&&!i&&e(n),hi(n,s=>{Lr(s,e,!0,i)}),t&&i&&e(n)}function vn(n){return new B(null===n.parent?n.name:vn(n.parent)+"/"+n.name)}function _s(n){null!==n.parent&&function Yl(n,e,t){const i=function Hl(n){return void 0===At(n)&&!Fr(n)}(t),s=(0,c.r3)(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,_s(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,_s(n))}(n.parent,n.name,n)}const zl=/[\[\].#$\/\u0000-\u001F\u007F]/,Kl=/[\[\].#$\u0000-\u001F\u007F]/,ps=10485760,fi=function(n){return"string"==typeof n&&0!==n.length&&!zl.test(n)},Wr=function(n){return"string"==typeof n&&0!==n.length&&!Kl.test(n)},yn=function(n){return null===n||"string"==typeof n||"number"==typeof n&&!it(n)||n&&"object"==typeof n&&(0,c.r3)(n,".sv")},Ge=function(n,e,t,i){i&&void 0===e||Cn((0,c.gK)(n,"value"),e,t)},Cn=function(n,e,t){const i=t instanceof B?new ua(t,n):t;if(void 0===e)throw new Error(n+"contains undefined "+wt(i));if("function"==typeof e)throw new Error(n+"contains a function "+wt(i)+" with contents = "+e.toString());if(it(e))throw new Error(n+"contains "+e.toString()+" "+wt(i));if("string"==typeof e&&e.length>ps/3&&(0,c.ug)(e)>ps)throw new Error(n+"contains a string greater than "+ps+" utf8 bytes "+wt(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let s=!1,r=!1;if(q(e,(o,a)=>{if(".value"===o)s=!0;else if(".priority"!==o&&".sv"!==o&&(r=!0,!fi(o)))throw new Error(n+" contains an invalid key ("+o+") "+wt(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function da(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=(0,c.ug)(e),Qs(n)})(i,o),Cn(n,a,i),function ha(n){const e=n.parts_.pop();n.byteLength_-=(0,c.ug)(e),n.parts_.length>0&&(n.byteLength_-=1)}(i)}),s&&r)throw new Error(n+' contains ".value" child '+wt(i)+" in addition to actual children.")}},Br=function(n,e,t,i){if(i&&void 0===e)return;const s=(0,c.gK)(n,"values");if(!e||"object"!=typeof e||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const r=[];q(e,(o,a)=>{const l=new B(o);if(Cn(s,a,z(t,l)),".priority"===Pi(l)&&!yn(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];const r=sn(i);for(let o=0;o<r.length;o++)if((".priority"!==r[o]||o!==r.length-1)&&!fi(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(ca);let s=null;for(t=0;t<e.length;t++){if(i=e[t],null!==s&&be(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}}(s,r)},gs=function(n,e,t){if(!t||void 0!==e){if(it(e))throw new Error((0,c.gK)(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!yn(e))throw new Error((0,c.gK)(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},En=function(n,e,t,i){if(!(i&&void 0===t||fi(t)))throw new Error((0,c.gK)(n,e)+'was an invalid key = "'+t+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},wn=function(n,e,t,i){if(!(i&&void 0===t||Wr(t)))throw new Error((0,c.gK)(n,e)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Zl=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),wn(n,e,t,i)},Se=function(n,e){if(".info"===R(e))throw new Error(n+" failed = Can't modify data under /.info/")},Ur=function(n,e){const t=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!fi(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==t.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Wr(n)}(t))throw new Error((0,c.gK)(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Xl{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function _i(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();null!==t&&!xi(r,t.path)&&(n.eventLists_.push(t),t=null),null===t&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function Vr(n,e,t){_i(n,t),Gr(n,i=>xi(i,e))}function ve(n,e,t){_i(n,t),Gr(n,i=>be(i,e)||be(e,i))}function Gr(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];s&&(e(s.path)?(Jl(n.eventLists_[i]),n.eventLists_[i]=null):t=!1)}t&&(n.eventLists_=[]),n.recursionDepth_--}function Jl(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(null!==t){n.events[e]=null;const i=t.getEventRunner();$e&&J("event: "+t.toString()),st(i)}}}const Hr="repo_interrupt",ql=25;class ec{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Xl,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Xn(),this.transactionQueueTree_=new hs,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function jr(n){const t=n.infoData_.getNode(new B(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function In(n){return Ul({timestamp:jr(n)})}function Yr(n,e,t,i,s){n.dataUpdateCount++;const r=new B(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){const l=(0,c.UI)(t,u=>Z(u));o=function Ol(n,e,t,i){const s=rs(n,i);if(s){const r=os(s),o=r.path,a=r.queryId,l=de(o,e),u=j.fromObject(t);return as(n,o,new Gt(zi(a),l,u))}return[]}(n.serverSyncTree_,r,l,s)}else{const l=Z(t);o=Nr(n.serverSyncTree_,r,l,s)}else if(i){const l=(0,c.UI)(t,u=>Z(u));o=function Pl(n,e,t){const i=j.fromObject(t);return jt(n,new Gt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,i))}(n.serverSyncTree_,r,l)}else{const l=Z(t);o=pn(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=zt(n,r)),ve(n.eventQueue_,a,o)}function zr(n,e){ms(n,"connected",e),!1===e&&function rc(n){Yt(n,"onDisconnectEvents");const e=In(n),t=Xn();Hi(n.onDisconnect_,L(),(s,r)=>{const o=Mr(s,r,n.serverSyncTree_,e);Vt(t,s,o)});let i=[];Hi(t,L(),(s,r)=>{i=i.concat(pn(n.serverSyncTree_,s,r));const o=Es(n,s);zt(n,o)}),n.onDisconnect_=Xn(),ve(n.eventQueue_,L(),i)}(n)}function ms(n,e,t){const i=new B("/.info/"+e),s=Z(t);n.infoData_.updateSnapshot(i,s);const r=pn(n.infoSyncTree_,i,s);ve(n.eventQueue_,i,r)}function pi(n){return n.nextWriteId_++}function vs(n,e,t,i,s){Yt(n,"set",{path:e.toString(),value:t,priority:i});const r=In(n),o=Z(t,i),a=ci(n.serverSyncTree_,e),l=us(o,a,r),u=pi(n),_=is(n.serverSyncTree_,e,l,u,!0);_i(n.eventQueue_,_),n.server_.put(e.toString(),o.val(!0),(v,w)=>{const I="ok"===v;I||ne("set at "+e+" failed: "+v);const N=ft(n.serverSyncTree_,u,!I);ve(n.eventQueue_,e,N),_t(0,s,v,w)});const m=Es(n,e);zt(n,m),ve(n.eventQueue_,m,[])}function oc(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,s)=>{"ok"===i&&Gi(n.onDisconnect_,e),_t(0,t,i,s)})}function Kr(n,e,t,i){const s=Z(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{"ok"===r&&Vt(n.onDisconnect_,e,s),_t(0,i,r,o)})}function ys(n,e,t){let i;i=".info"===R(e._path)?li(n.infoSyncTree_,e,t):li(n.serverSyncTree_,e,t),Vr(n.eventQueue_,e._path,i)}function Qr(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Hr)}function Yt(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),J(t,...e)}function _t(n,e,t,i){e&&st(()=>{if("ok"===t)e(null);else{const s=(t||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,e(o)}})}function Cs(n,e,t){return ci(n.serverSyncTree_,e,t)||A.EMPTY_NODE}function gi(n,e=n.transactionQueueTree_){if(e||mi(n,e),At(e)){const t=Zr(n,e);(0,c.hu)(t.length>0,"Sending zero length transaction queue"),t.every(s=>0===s.status)&&function hc(n,e,t){const i=t.map(u=>u.currentWriteId),s=Cs(n,e,i);let r=s;const o=s.hash();for(let u=0;u<t.length;u++){const _=t[u];(0,c.hu)(0===_.status,"tryToSendTransactionQueue_: items in queue should all be run."),_.status=1,_.retryCount++;const m=de(e,_.path);r=r.updateChild(m,_.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;n.server_.put(l.toString(),a,u=>{Yt(n,"transaction put response",{path:l.toString(),status:u});let _=[];if("ok"===u){const m=[];for(let v=0;v<t.length;v++)t[v].status=2,_=_.concat(ft(n.serverSyncTree_,t[v].currentWriteId)),t[v].onComplete&&m.push(()=>t[v].onComplete(null,!0,t[v].currentOutputSnapshotResolved)),t[v].unwatcher();mi(n,di(n.transactionQueueTree_,e)),gi(n,n.transactionQueueTree_),ve(n.eventQueue_,e,_);for(let v=0;v<m.length;v++)st(m[v])}else{if("datastale"===u)for(let m=0;m<t.length;m++)t[m].status=3===t[m].status?4:0;else{ne("transaction at "+l.toString()+" failed: "+u);for(let m=0;m<t.length;m++)t[m].status=4,t[m].abortReason=u}zt(n,e)}},o)}(n,vn(e),t)}else Fr(e)&&hi(e,t=>{gi(n,t)})}function zt(n,e){const t=$r(n,e),i=vn(t);return function fc(n,e,t){if(0===e.length)return;const i=[];let s=[];const o=e.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=de(t,l.path);let m,_=!1;if((0,c.hu)(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)_=!0,m=l.abortReason,s=s.concat(ft(n.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=ql)_=!0,m="maxretry",s=s.concat(ft(n.serverSyncTree_,l.currentWriteId,!0));else{const v=Cs(n,l.path,o);l.currentInputSnapshot=v;const w=e[a].update(v.val());if(void 0!==w){Cn("transaction failed: Data returned ",w,l.path);let I=Z(w);"object"==typeof w&&null!=w&&(0,c.r3)(w,".priority")||(I=I.updatePriority(v.getPriority()));const K=l.currentWriteId,he=In(n),Ce=us(I,v,he);l.currentOutputSnapshotRaw=I,l.currentOutputSnapshotResolved=Ce,l.currentWriteId=pi(n),o.splice(o.indexOf(K),1),s=s.concat(is(n.serverSyncTree_,l.path,Ce,l.currentWriteId,l.applyLocally)),s=s.concat(ft(n.serverSyncTree_,K,!0))}else _=!0,m="nodata",s=s.concat(ft(n.serverSyncTree_,l.currentWriteId,!0))}ve(n.eventQueue_,t,s),s=[],_&&(e[a].status=2,setTimeout(e[a].unwatcher,Math.floor(0)),e[a].onComplete&&i.push("nodata"===m?()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot):()=>e[a].onComplete(new Error(m),!1,null)))}mi(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)st(i[a]);gi(n,n.transactionQueueTree_)}(n,Zr(n,t),i),i}function $r(n,e){let t,i=n.transactionQueueTree_;for(t=R(e);null!==t&&void 0===At(i);)i=di(i,t),t=R(e=V(e));return i}function Zr(n,e){const t=[];return Xr(n,e,t),t.sort((i,s)=>i.order-s.order),t}function Xr(n,e,t){const i=At(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);hi(e,s=>{Xr(n,s,t)})}function mi(n,e){const t=At(e);if(t){let i=0;for(let s=0;s<t.length;s++)2!==t[s].status&&(t[i]=t[s],i++);t.length=i,fs(e,t.length>0?t:void 0)}hi(e,i=>{mi(n,i)})}function Es(n,e){const t=vn($r(n,e)),i=di(n.transactionQueueTree_,e);return function jl(n,e,t){let i=t?n:n.parent;for(;null!==i;){if(e(i))return!0;i=i.parent}}(i,s=>{ws(n,s)}),ws(n,i),Lr(i,s=>{ws(n,s)}),t}function ws(n,e){const t=At(e);if(t){const i=[];let s=[],r=-1;for(let o=0;o<t.length;o++)3===t[o].status||(1===t[o].status?((0,c.hu)(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):((0,c.hu)(0===t[o].status,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(ft(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));-1===r?fs(e,void 0):t.length=r+1,ve(n.eventQueue_,vn(e),s);for(let o=0;o<i.length;o++)st(i[o])}}const Is=function(n,e){const t=gc(n),i=t.namespace;return"firebase.com"===t.domain&&Ee(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==t.domain&&Ee("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ne("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new p(t.host,t.secure,i,"ws"===t.scheme||"wss"===t.scheme,e,"",i!==t.subdomain),path:new B(t.pathString)}},gc=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",l=443;if("string"==typeof n){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let _=n.indexOf("/");-1===_&&(_=n.length);let m=n.indexOf("?");-1===m&&(m=n.length),e=n.substring(0,Math.min(_,m)),_<m&&(s=function _c(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}(n.substring(_,m)));const v=function pc(n){const e={};"?"===n.charAt(0)&&(n=n.substring(1));for(const t of n.split("&")){if(0===t.length)continue;const i=t.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):ne(`Invalid query segment '${t}' in query '${n}'`)}return e}(n.substring(Math.min(n.length,m)));u=e.indexOf(":"),u>=0?(o="https"===a||"wss"===a,l=parseInt(e.substring(u+1),10)):u=e.length;const w=e.slice(0,u);if("localhost"===w.toLowerCase())t="localhost";else if(w.split(".").length<=2)t=w;else{const I=e.indexOf(".");i=e.substring(0,I).toLowerCase(),t=e.substring(I+1),r=i}"ns"in v&&(r=v.ns)}return{host:e,port:l,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}},Jr="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",mc=function(){let n=0;const e=[];return function(t){const i=t===n;let s;n=t;const r=new Array(8);for(s=7;s>=0;s--)r[s]=Jr.charAt(t%64),t=Math.floor(t/64);(0,c.hu)(0===t,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&63===e[s];s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)o+=Jr.charAt(e[s]);return(0,c.hu)(20===o.length,"nextPushId: Length should be 20."),o}}();class qr{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,c.Wl)(this.snapshot.exportVal())}}class eo{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class bs{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,c.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class to{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new c.BH;return oc(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Se("OnDisconnect.remove",this._path);const e=new c.BH;return Kr(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Se("OnDisconnect.set",this._path),Ge("OnDisconnect.set",e,this._path,!1);const t=new c.BH;return Kr(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Se("OnDisconnect.setWithPriority",this._path),Ge("OnDisconnect.setWithPriority",e,this._path,!1),gs("OnDisconnect.setWithPriority",t,!1);const i=new c.BH;return function ac(n,e,t,i,s){const r=Z(t,i);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{"ok"===o&&Vt(n.onDisconnect_,e,r),_t(0,s,o,a)})}(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){Se("OnDisconnect.update",this._path),Br("OnDisconnect.update",e,this._path,!1);const t=new c.BH;return function lc(n,e,t,i){if((0,c.xb)(t))return J("onDisconnect().update() called with empty data.  Don't do anything."),void _t(0,i,"ok",void 0);n.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{"ok"===s&&q(t,(o,a)=>{const l=Z(a);Vt(n.onDisconnect_,z(e,o),l)}),_t(0,i,s,r)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class ge{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return k(this._path)?null:Pi(this._path)}get ref(){return new Te(this._repo,this._path)}get _queryIdentifier(){const e=rr(this._queryParams),t=Ze(e);return"{}"===t?"default":t}get _queryObject(){return rr(this._queryParams)}isEqual(e){if(!((e=(0,c.m9)(e))instanceof ge))return!1;const t=this._repo===e._repo,i=xi(this._path,e._path);return t&&i&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function la(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)""!==n.pieces_[t]&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}(this._path)}}function vi(n,e){if(!0===n._orderByCalled)throw new Error(e+": You can't combine multiple orderBy calls.")}function pt(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Ue){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==ke)throw new Error(i);if("string"!=typeof e)throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Ne)throw new Error(i);if("string"!=typeof t)throw new Error(s)}}else if(n.getIndex()===H){if(null!=e&&!yn(e)||null!=t&&!yn(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,c.hu)(n.getIndex()instanceof Li||n.getIndex()===Wi,"unknown index type."),null!=e&&"object"==typeof e||null!=t&&"object"==typeof t)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function yi(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Te extends ge{constructor(e,t){super(e,t,new Qn,!1)}get parent(){const e=Ks(this._path);return null===e?null:new Te(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Rt{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new B(e),i=kt(this.ref,e);return new Rt(this._node.getChild(t),i,H)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(i,s)=>e(new Rt(s,kt(this.ref,i),H)))}hasChild(e){const t=new B(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function no(n,e){return(n=(0,c.m9)(n))._checkNotDeleted("ref"),void 0!==e?kt(n._root,e):n._root}function io(n,e){(n=(0,c.m9)(n))._checkNotDeleted("refFromURL");const t=Is(e,n._repo.repoInfo_.nodeAdmin);Ur("refFromURL",t);const i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&Ee("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),no(n,t.path.toString())}function kt(n,e){return null===R((n=(0,c.m9)(n))._path)?Zl("child","path",e,!1):wn("child","path",e,!1),new Te(n._repo,z(n._path,e))}function Ss(n,e){n=(0,c.m9)(n),Se("set",n._path),Ge("set",e,n._path,!1);const t=new c.BH;return vs(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function wc(n,e){Br("update",e,n._path,!1);const t=new c.BH;return function sc(n,e,t,i){Yt(n,"update",{path:e.toString(),value:t});let s=!0;const r=In(n),o={};if(q(t,(a,l)=>{s=!1,o[a]=Mr(z(e,a),Z(l),n.serverSyncTree_,r)}),s)J("update() called with empty data.  Don't do anything."),_t(0,i,"ok",void 0);else{const a=pi(n),l=function Nl(n,e,t,i){!function Ka(n,e,t,i){(0,c.hu)(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=Qi(n.visibleWrites,e,t),n.lastWriteId=i}(n.pendingWriteTree_,e,t,i);const s=j.fromObject(t);return jt(n,new Gt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,s))}(n.serverSyncTree_,e,o,a);_i(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,_)=>{const m="ok"===u;m||ne("update at "+e+" failed: "+u);const v=ft(n.serverSyncTree_,a,!m),w=v.length>0?zt(n,e):e;ve(n.eventQueue_,w,v),_t(0,i,u,_)}),q(t,u=>{const _=Es(n,z(e,u));zt(n,_)}),ve(n.eventQueue_,e,[])}}(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Ic(n){n=(0,c.m9)(n);const e=new bs(()=>{}),t=new bn(e);return function ic(n,e,t){const i=function Ml(n,e){const t=e._path;let i=null;n.syncPointTree_.foreachOnPath(t,(u,_)=>{const m=de(u,t);i=i||dt(_,m)});let s=n.syncPointTree_.get(t);s?i=i||dt(s,L()):(s=new br,n.syncPointTree_=n.syncPointTree_.set(t,s));const r=null!=i,o=r?new ct(i,!0,!1):null;return function vl(n){return ei(n.viewCache_)}(Sr(s,e,ti(n.pendingWriteTree_,e._path),r?o.getNode():A.EMPTY_NODE,r))}(n.serverSyncTree_,e);return null!=i?Promise.resolve(i):n.server_.get(e).then(s=>{const r=Z(s).withIndex(e._queryParams.getIndex());let o;if(ss(n.serverSyncTree_,e,t,!0),e._queryParams.loadsAllData())o=pn(n.serverSyncTree_,e._path,r);else{const a=gn(n.serverSyncTree_,e);o=Nr(n.serverSyncTree_,e._path,r,a)}return ve(n.eventQueue_,e._path,o),li(n.serverSyncTree_,e,t,null,!0),r},s=>(Yt(n,"get for query "+(0,c.Wl)(e)+" failed: "+s),Promise.reject(new Error(s))))}(n._repo,n,t).then(i=>new Rt(i,new Te(n._repo,n._path),n._queryParams.getIndex()))}class bn{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const i=t._queryParams.getIndex();return new qr("value",this,new Rt(e.snapshotNode,new Te(t._repo,t._path),i))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new eo(this,e,t):null}matches(e){return e instanceof bn&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Ci{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new eo(this,e,t):null}createEvent(e,t){(0,c.hu)(null!=e.childName,"Child events should have a childName.");const i=kt(new Te(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new qr(e.type,this,new Rt(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Ci&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function Sn(n,e,t,i,s){let r;if("object"==typeof i&&(r=void 0,s=i),"function"==typeof i&&(r=i),s&&s.onlyOnce){const l=t,u=(_,m)=>{ys(n._repo,n,a),l(_,m)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new bs(t,r||void 0),a="value"===e?new bn(o):new Ci(e,o);return function cc(n,e,t){let i;i=".info"===R(e._path)?ss(n.infoSyncTree_,e,t):ss(n.serverSyncTree_,e,t),Vr(n.eventQueue_,e._path,i)}(n._repo,n,a),()=>ys(n._repo,n,a)}function Ts(n,e,t,i){return Sn(n,"value",e,t,i)}function so(n,e,t,i){return Sn(n,"child_added",e,t,i)}function ro(n,e,t,i){return Sn(n,"child_changed",e,t,i)}function oo(n,e,t,i){return Sn(n,"child_moved",e,t,i)}function ao(n,e,t,i){return Sn(n,"child_removed",e,t,i)}function lo(n,e,t){let i=null;const s=t?new bs(t):null;"value"===e?i=new bn(s):e&&(i=new Ci(e,s)),ys(n._repo,n,i)}class Oe{}class co extends Oe{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Ge("endAt",this._value,e._path,!0);const t=Vi(e._queryParams,this._value,this._key);if(yi(t),pt(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ge(e._repo,e._path,t,e._orderByCalled)}}class Sc extends Oe{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Ge("endBefore",this._value,e._path,!1);const t=function Oa(n,e,t){let i;return i=Vi(n,e,n.index_===Ue||t?t:ke),i.endBeforeSet_=!0,i}(e._queryParams,this._value,this._key);if(yi(t),pt(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ge(e._repo,e._path,t,e._orderByCalled)}}class uo extends Oe{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Ge("startAt",this._value,e._path,!0);const t=Ui(e._queryParams,this._value,this._key);if(yi(t),pt(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new ge(e._repo,e._path,t,e._orderByCalled)}}class Rc extends Oe{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Ge("startAfter",this._value,e._path,!1);const t=function Da(n,e,t){let i;return i=Ui(n,e,n.index_===Ue||t?t:Ne),i.startAfterSet_=!0,i}(e._queryParams,this._value,this._key);if(yi(t),pt(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new ge(e._repo,e._path,t,e._orderByCalled)}}class Nc extends Oe{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new ge(e._repo,e._path,function Pa(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}(e._queryParams,this._limit),e._orderByCalled)}}class xc extends Oe{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new ge(e._repo,e._path,function xa(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}(e._queryParams,this._limit),e._orderByCalled)}}class Oc extends Oe{constructor(e){super(),this._path=e}_apply(e){vi(e,"orderByChild");const t=new B(this._path);if(k(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new Li(t),s=$n(e._queryParams,i);return pt(s),new ge(e._repo,e._path,s,!0)}}class Fc extends Oe{_apply(e){vi(e,"orderByKey");const t=$n(e._queryParams,Ue);return pt(t),new ge(e._repo,e._path,t,!0)}}class Wc extends Oe{_apply(e){vi(e,"orderByPriority");const t=$n(e._queryParams,H);return pt(t),new ge(e._repo,e._path,t,!0)}}class Uc extends Oe{_apply(e){vi(e,"orderByValue");const t=$n(e._queryParams,Wi);return pt(t),new ge(e._repo,e._path,t,!0)}}class Gc extends Oe{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Ge("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new co(this._value,this._key)._apply(new uo(this._value,this._key)._apply(e))}}function Me(n,...e){let t=(0,c.m9)(n);for(const i of e)t=i._apply(t);return t}(function wl(n){(0,c.hu)(!ri,"__referenceConstructor has already been defined"),ri=n})(Te),function Al(n){(0,c.hu)(!ai,"__referenceConstructor has already been defined"),ai=n}(Te);const As={};function fo(n,e,t,i,s){let r=i||n.options.databaseURL;void 0===r&&(n.options.projectId||Ee("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),J("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let l,u,o=Is(r,s),a=o.repoInfo;typeof process<"u"&&process.env&&(u=process.env.FIREBASE_DATABASE_EMULATOR_HOST),u?(l=!0,r=`http://${u}?ns=${a.namespace}`,o=Is(r,s),a=o.repoInfo):l=!o.repoInfo.secure;const _=s&&l?new Xe(Xe.OWNER):new Jt(n.name,n.options,e);Ur("Invalid Firebase Database URL",o),k(o.path)||Ee("Database URL must point to the root of a Firebase Database (not including a child path).");const m=function Kc(n,e,t,i){let s=As[e.name];s||(s={},As[e.name]=s);let r=s[n.toURLString()];return r&&Ee("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new ec(n,false,t,i),s[n.toURLString()]=r,r}(a,n,_,new ce(n.name,t));return new $c(m,n)}class $c{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function tc(n,e,t){if(n.stats_=M(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new Zn(n.repoInfo_,(i,s,r,o)=>{Yr(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>zr(n,!0),0);else{if(typeof t<"u"&&null!==t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,c.Wl)(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new It(n.repoInfo_,e,(i,s,r,o)=>{Yr(n,i,s,r,o)},i=>{zr(n,i)},i=>{!function nc(n,e){q(e,(t,i)=>{ms(n,t,i)})}(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=function U(n,e){const t=n.toString();return T[t]||(T[t]=e()),T[t]}(n.repoInfo_,()=>new Ua(n.stats_,n.server_)),n.infoData_=new Ma,n.infoSyncTree_=new kr({startListening:(i,s,r,o)=>{let a=[];const l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=pn(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),ms(n,"connected",!1),n.serverSyncTree_=new kr({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,l)=>{const u=o(a,l);ve(n.eventQueue_,i._path,u)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Te(this._repo,L())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function zc(n,e){const t=As[e];(!t||t[n.key]!==n)&&Ee(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Qr(n),delete t[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Ee("Cannot call "+e+" on a deleted database.")}}function _o(){Ms.IS_TRANSPORT_INITIALIZED&&ne("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Zc(){_o(),at.forceDisallow()}function Xc(){_o(),Lt.forceDisallow(),at.forceAllow()}function eu(n,e){Dn(n,e)}const nu={".sv":"timestamp"};class ru{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}It.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},It.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)},function tu(n){kn(O.SDK_VERSION),(0,O._registerComponent)(new $.wA("database",(e,{instanceIdentifier:t})=>fo(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,O.registerVersion)(me,"0.14.4",n),(0,O.registerVersion)(me,"0.14.4","esm2017")}();const cu=new X.Yd("@firebase/database-compat"),go=function(n){cu.warn("FIREBASE WARNING: "+n)};class hu{constructor(e){this._delegate=e}cancel(e){(0,c.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,c.Wj)("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){(0,c.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,c.Wj)("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){(0,c.Dv)("OnDisconnect.set",1,2,arguments.length),(0,c.Wj)("OnDisconnect.set","onComplete",t,!0);const i=this._delegate.set(e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){(0,c.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,c.Wj)("OnDisconnect.setWithPriority","onComplete",i,!0);const s=this._delegate.setWithPriority(e,t);return i&&s.then(()=>i(null),r=>i(r)),s}update(e,t){if((0,c.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,go("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,c.Wj)("OnDisconnect.update","onComplete",t,!0);const i=this._delegate.update(e);return t&&i.then(()=>t(null),s=>t(s)),i}}class fu{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return(0,c.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class gt{constructor(e,t){this._database=e,this._delegate=t}val(){return(0,c.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return(0,c.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return(0,c.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return(0,c.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return(0,c.Dv)("DataSnapshot.child",0,1,arguments.length),e=String(e),wn("DataSnapshot.child","path",e,!1),new gt(this._database,this._delegate.child(e))}hasChild(e){return(0,c.Dv)("DataSnapshot.hasChild",1,1,arguments.length),wn("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return(0,c.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return(0,c.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,c.Wj)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new gt(this._database,t)))}hasChildren(){return(0,c.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return(0,c.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return(0,c.Dv)("DataSnapshot.ref",0,0,arguments.length),new ye(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class oe{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,s){var r;(0,c.Dv)("Query.on",2,4,arguments.length),(0,c.Wj)("Query.on","callback",t,!1);const o=oe.getCancelAndContextArgs_("Query.on",i,s),a=(u,_)=>{t.call(o.context,new gt(this.database,u),_)};a.userCallback=t,a.context=o.context;const l=null===(r=o.cancel)||void 0===r?void 0:r.bind(o.context);switch(e){case"value":return Ts(this._delegate,a,l),t;case"child_added":return so(this._delegate,a,l),t;case"child_removed":return ao(this._delegate,a,l),t;case"child_changed":return ro(this._delegate,a,l),t;case"child_moved":return oo(this._delegate,a,l),t;default:throw new Error((0,c.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if((0,c.Dv)("Query.off",0,3,arguments.length),function(n,e,t){if(void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,c.gK)("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(0,e),(0,c.Wj)("Query.off","callback",t,!0),(0,c.lb)("Query.off","context",i,!0),t){const s=()=>{};s.userCallback=t,s.context=i,lo(this._delegate,e,s)}else lo(this._delegate,e)}get(){return Ic(this._delegate).then(e=>new gt(this.database,e))}once(e,t,i,s){(0,c.Dv)("Query.once",1,4,arguments.length),(0,c.Wj)("Query.once","callback",t,!0);const r=oe.getCancelAndContextArgs_("Query.once",i,s),o=new c.BH,a=(u,_)=>{const m=new gt(this.database,u);t&&t.call(r.context,m,_),o.resolve(m)};a.userCallback=t,a.context=r.context;const l=u=>{r.cancel&&r.cancel.call(r.context,u),o.reject(u)};switch(e){case"value":Ts(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":so(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":ao(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":ro(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":oo(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error((0,c.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return(0,c.Dv)("Query.limitToFirst",1,1,arguments.length),new oe(this.database,Me(this._delegate,function Pc(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Nc(n)}(e)))}limitToLast(e){return(0,c.Dv)("Query.limitToLast",1,1,arguments.length),new oe(this.database,Me(this._delegate,function Dc(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new xc(n)}(e)))}orderByChild(e){return(0,c.Dv)("Query.orderByChild",1,1,arguments.length),new oe(this.database,Me(this._delegate,function Mc(n){if("$key"===n)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===n)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===n)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return wn("orderByChild","path",n,!1),new Oc(n)}(e)))}orderByKey(){return(0,c.Dv)("Query.orderByKey",0,0,arguments.length),new oe(this.database,Me(this._delegate,function Lc(){return new Fc}()))}orderByPriority(){return(0,c.Dv)("Query.orderByPriority",0,0,arguments.length),new oe(this.database,Me(this._delegate,function Bc(){return new Wc}()))}orderByValue(){return(0,c.Dv)("Query.orderByValue",0,0,arguments.length),new oe(this.database,Me(this._delegate,function Vc(){return new Uc}()))}startAt(e=null,t){return(0,c.Dv)("Query.startAt",0,2,arguments.length),new oe(this.database,Me(this._delegate,function Ac(n=null,e){return En("startAt","key",e,!0),new uo(n,e)}(e,t)))}startAfter(e=null,t){return(0,c.Dv)("Query.startAfter",0,2,arguments.length),new oe(this.database,Me(this._delegate,function kc(n,e){return En("startAfter","key",e,!0),new Rc(n,e)}(e,t)))}endAt(e=null,t){return(0,c.Dv)("Query.endAt",0,2,arguments.length),new oe(this.database,Me(this._delegate,function bc(n,e){return En("endAt","key",e,!0),new co(n,e)}(e,t)))}endBefore(e=null,t){return(0,c.Dv)("Query.endBefore",0,2,arguments.length),new oe(this.database,Me(this._delegate,function Tc(n,e){return En("endBefore","key",e,!0),new Sc(n,e)}(e,t)))}equalTo(e,t){return(0,c.Dv)("Query.equalTo",1,2,arguments.length),new oe(this.database,Me(this._delegate,function Hc(n,e){return En("equalTo","key",e,!0),new Gc(n,e)}(e,t)))}toString(){return(0,c.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return(0,c.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if((0,c.Dv)("Query.isEqual",1,1,arguments.length),!(e instanceof oe))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){const s={cancel:void 0,context:void 0};if(t&&i)s.cancel=t,(0,c.Wj)(e,"cancel",s.cancel,!0),s.context=i,(0,c.lb)(e,"context",s.context,!0);else if(t)if("object"==typeof t&&null!==t)s.context=t;else{if("function"!=typeof t)throw new Error((0,c.gK)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");s.cancel=t}return s}get ref(){return new ye(this.database,new Te(this._delegate._repo,this._delegate._path))}}class ye extends oe{constructor(e,t){super(e,new ge(t._repo,t._path,new Qn,!1)),this.database=e,this._delegate=t}getKey(){return(0,c.Dv)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return(0,c.Dv)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new ye(this.database,kt(this._delegate,e))}getParent(){(0,c.Dv)("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new ye(this.database,e):null}getRoot(){return(0,c.Dv)("Reference.root",0,0,arguments.length),new ye(this.database,this._delegate.root)}set(e,t){(0,c.Dv)("Reference.set",1,2,arguments.length),(0,c.Wj)("Reference.set","onComplete",t,!0);const i=Ss(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}update(e,t){if((0,c.Dv)("Reference.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,go("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Se("Reference.update",this._delegate._path),(0,c.Wj)("Reference.update","onComplete",t,!0);const i=wc(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){(0,c.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,c.Wj)("Reference.setWithPriority","onComplete",i,!0);const s=function Ec(n,e,t){if(Se("setWithPriority",n._path),Ge("setWithPriority",e,n._path,!1),gs("setWithPriority",t,!1),".length"===n.key||".keys"===n.key)throw"setWithPriority failed: "+n.key+" is a read-only object.";const i=new c.BH;return vs(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}(this._delegate,e,t);return i&&s.then(()=>i(null),r=>i(r)),s}remove(e){(0,c.Dv)("Reference.remove",0,1,arguments.length),(0,c.Wj)("Reference.remove","onComplete",e,!0);const t=function yc(n){return Se("remove",n._path),Ss(n,null)}(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){(0,c.Dv)("Reference.transaction",1,3,arguments.length),(0,c.Wj)("Reference.transaction","transactionUpdate",e,!1),(0,c.Wj)("Reference.transaction","onComplete",t,!0),function(n,e,t,i){if(void 0!==t&&"boolean"!=typeof t)throw new Error((0,c.gK)("Reference.transaction","applyLocally")+"must be a boolean.")}(0,0,i);const s=function ou(n,e,t){var i;if(n=(0,c.m9)(n),Se("Reference.transaction",n._path),".length"===n.key||".keys"===n.key)throw"Reference.transaction failed: "+n.key+" is a read-only object.";const s=null===(i=t?.applyLocally)||void 0===i||i,r=new c.BH,a=Ts(n,()=>{});return function dc(n,e,t,i,s,r){Yt(n,"transaction on "+e);const o={path:e,update:t,onComplete:i,status:null,order:Pn(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Cs(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(void 0===l)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Cn("transaction failed: Data returned ",l,o.path),o.status=0;const u=di(n.transactionQueueTree_,e),_=At(u)||[];let m;_.push(o),fs(u,_),"object"==typeof l&&null!==l&&(0,c.r3)(l,".priority")?(m=(0,c.DV)(l,".priority"),(0,c.hu)(yn(m),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):m=(ci(n.serverSyncTree_,e)||A.EMPTY_NODE).getPriority().val();const v=In(n),w=Z(l,m),I=us(w,a,v);o.currentOutputSnapshotRaw=w,o.currentOutputSnapshotResolved=I,o.currentWriteId=pi(n);const N=is(n.serverSyncTree_,e,I,o.currentWriteId,o.applyLocally);ve(n.eventQueue_,e,N),gi(n,n.transactionQueueTree_)}}(n._repo,n._path,e,(l,u,_)=>{let m=null;l?r.reject(l):(m=new Rt(_,new Te(n._repo,n._path),H),r.resolve(new ru(u,m)))},a,s),r.promise}(this._delegate,e,{applyLocally:i}).then(r=>new fu(r.committed,new gt(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){(0,c.Dv)("Reference.setPriority",1,2,arguments.length),(0,c.Wj)("Reference.setPriority","onComplete",t,!0);const i=function Cc(n,e){n=(0,c.m9)(n),Se("setPriority",n._path),gs("setPriority",e,!1);const t=new c.BH;return vs(n._repo,z(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}push(e,t){(0,c.Dv)("Reference.push",0,2,arguments.length),(0,c.Wj)("Reference.push","onComplete",t,!0);const i=function vc(n,e){n=(0,c.m9)(n),Se("push",n._path),Ge("push",e,n._path,!0);const t=jr(n._repo),i=mc(t),s=kt(n,i),r=kt(n,i);let o;return o=null!=e?Ss(r,e).then(()=>r):Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}(this._delegate,e),s=i.then(o=>new ye(this.database,o));t&&s.then(()=>t(null),o=>t(o));const r=new ye(this.database,i);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return Se("Reference.onDisconnect",this._delegate._path),new hu(new to(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class Tn{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Zc,forceLongPolling:Xc}}useEmulator(e,t,i={}){!function po(n,e,t,i={}){(n=(0,c.m9)(n))._checkNotDeleted("useEmulator"),n._instanceStarted&&Ee("Cannot call useEmulator() after instance has already been initialized.");const s=n._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&Ee('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Xe(Xe.OWNER);else if(i.mockUserToken){const o="string"==typeof i.mockUserToken?i.mockUserToken:(0,c.Sg)(i.mockUserToken,n.app.options.projectId);r=new Xe(o)}!function Yc(n,e,t,i){n.repoInfo_=new p(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}(s,e,t,r)}(this._delegate,e,t,i)}ref(e){if((0,c.Dv)("database.ref",0,1,arguments.length),e instanceof ye){const t=io(this._delegate,e.toString());return new ye(this,t)}{const t=no(this._delegate,e);return new ye(this,t)}}refFromURL(e){(0,c.Dv)("database.refFromURL",1,1,arguments.length);const i=io(this._delegate,e);return new ye(this,i)}goOffline(){return(0,c.Dv)("database.goOffline",0,0,arguments.length),function Jc(n){(n=(0,c.m9)(n))._checkNotDeleted("goOffline"),Qr(n._repo)}(this._delegate)}goOnline(){return(0,c.Dv)("database.goOnline",0,0,arguments.length),function qc(n){(n=(0,c.m9)(n))._checkNotDeleted("goOnline"),function uc(n){n.persistentConnection_&&n.persistentConnection_.resume(Hr)}(n._repo)}(this._delegate)}}Tn.ServerValue={TIMESTAMP:function iu(){return nu}(),increment:n=>function su(n){return{".sv":{increment:n}}}(n)};var pu=Object.freeze({__proto__:null,initStandalone:function _u({app:n,url:e,version:t,customAuthImpl:i,namespace:s,nodeAdmin:r=!1}){kn(t);const o=new $.zt("auth-internal",new $.H0("database-standalone"));return o.setComponent(new $.wA("auth-internal",()=>i,"PRIVATE")),{instance:new Tn(fo(n,o,void 0,e,r),n),namespace:s}}});const gu=Tn.ServerValue;!function mu(n){n.INTERNAL.registerComponent(new $.wA("database-compat",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new Tn(s,i)},"PUBLIC").setServiceProps({Reference:ye,Query:oe,Database:Tn,DataSnapshot:gt,enableLogging:eu,INTERNAL:pu,ServerValue:gu}).setMultipleInstances(!0)),n.registerVersion("@firebase/database-compat","0.3.4")}(le.Z);var Nt=C(8645),mo=C(2459),Ei=C(3093),vo=C(7081),vu=C(1374),yu=C(4674);function yo(n,e){return(0,yu.m)(e)?(0,re.w)(()=>n,e):(0,re.w)(()=>n)}var Rs=C(5137),Cu=C(2181),An=C(6814),Co=C(7247),Eu=C(7142);const Eo=new g.OlP("angularfire2.auth.use-emulator"),wo=new g.OlP("angularfire2.auth.settings"),Io=new g.OlP("angularfire2.auth.tenant-id"),bo=new g.OlP("angularfire2.auth.langugage-code"),So=new g.OlP("angularfire2.auth.use-device-language"),To=new g.OlP("angularfire.auth.persistence"),Ao=(n,e,t,i,s,r,o,a)=>(0,Y.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),i&&(l.tenantId=i),l.languageCode=s,r&&l.useDeviceLanguage(),o)for(const[u,_]of Object.entries(o))l.settings[u]=_;return a&&l.setPersistence(a),l},[t,i,s,r,o,a]);let Ro=(()=>{class n{constructor(t,i,s,r,o,a,l,u,_,m,v,w){const I=new Nt.x,N=(0,Le.of)(void 0).pipe((0,Ei.Q)(o.outsideAngular),(0,re.w)(()=>r.runOutsideAngular(()=>Promise.resolve().then(C.bind(C,6365)))),(0,se.U)(()=>(0,Y.on)(t,r,i)),(0,se.U)(K=>Ao(K,r,a,u,_,m,l,v)),(0,vo.d)({bufferSize:1,refCount:!1}));if((0,An.PM)(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Le.of)(null);else{N.pipe((0,vu.P)()).subscribe();const he=N.pipe((0,re.w)(ee=>ee.getRedirectResult().then(qe=>qe,()=>null)),x.iC,(0,vo.d)({bufferSize:1,refCount:!1})),Ce=N.pipe((0,re.w)(ee=>new G.y(qe=>({unsubscribe:r.runOutsideAngular(()=>ee.onAuthStateChanged(xt=>qe.next(xt),xt=>qe.error(xt),()=>qe.complete()))})))),je=N.pipe((0,re.w)(ee=>new G.y(qe=>({unsubscribe:r.runOutsideAngular(()=>ee.onIdTokenChanged(xt=>qe.next(xt),xt=>qe.error(xt),()=>qe.complete()))}))));this.authState=he.pipe(yo(Ce),(0,Rs.R)(o.outsideAngular),(0,Ei.Q)(o.insideAngular)),this.user=he.pipe(yo(je),(0,Rs.R)(o.outsideAngular),(0,Ei.Q)(o.insideAngular)),this.idToken=this.user.pipe((0,re.w)(ee=>ee?(0,mo.D)(ee.getIdToken()):(0,Le.of)(null))),this.idTokenResult=this.user.pipe((0,re.w)(ee=>ee?(0,mo.D)(ee.getIdTokenResult()):(0,Le.of)(null))),this.credential=(0,Ye.T)(he,I,this.authState.pipe((0,Cu.h)(ee=>!ee))).pipe((0,se.U)(ee=>ee?.user?ee:null),(0,Rs.R)(o.outsideAngular),(0,Ei.Q)(o.insideAngular))}return(0,Y.pX)(this,N,r,{spy:{apply:(K,he,Ce)=>{(K.startsWith("signIn")||K.startsWith("createUser"))&&Ce.then(je=>I.next(je))}}})}}return n.\u0275fac=function(t){return new(t||n)(g.LFG(Y.Dh),g.LFG(Y.xv,8),g.LFG(g.Lbi),g.LFG(g.R0b),g.LFG(x.HU),g.LFG(Eo,8),g.LFG(wo,8),g.LFG(Io,8),g.LFG(bo,8),g.LFG(So,8),g.LFG(To,8),g.LFG(Co.nm,8))},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();function ko(n){return null==n}function No(n){return"function"==typeof n.set}function Po(n,e){return No(e)?e:n.ref(e)}function xo(n,e){if(function Iu(n){return"string"==typeof n}(n))return e.stringCase();if(No(n))return e.firebaseCase();if(function bu(n){return"function"==typeof n.exportVal}(n))return e.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof n)}function Rn(n,e,t="on",i=f.z){return new G.y(s=>{let r=null;return r=n[t](e,(o,a)=>{i.schedule(()=>{s.next({snapshot:o,prevKey:a})}),"once"===t&&i.schedule(()=>s.complete())},o=>{i.schedule(()=>s.error(o))}),"on"===t?{unsubscribe(){null!=r&&n.off(e,r)}}:{unsubscribe(){}}}).pipe((0,se.U)(s=>{const{snapshot:r,prevKey:o}=s;let a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),(0,fe.B)())}function Do(n,e){const t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function Au(n,e){const{payload:t,prevKey:i,key:s}=e,r=Do(n,s),o=function Tu(n,e){if(ko(e))return 0;{const t=Do(n,e);return-1===t?n.length:t+1}}(n,i);switch(e.type){case"value":if(e.payload&&e.payload.exists()){let a=null;e.payload.forEach(l=>{const u={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,u],!1})}return n;case"child_added":if(r>-1){const a=n[r-1];(a&&a.key||null)!==i&&(n=n.filter(l=>l.payload.key!==t.key)).splice(o,0,e)}else{if(null==i)return[e,...n];(n=n.slice()).splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===s?e:a);case"child_moved":if(r>-1){const a=n.splice(r,1)[0];return(n=n.slice()).splice(o,0,a),n}return n;default:return n}}function Oo(n){return(ko(n)||0===n.length)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Mo(n,e,t){return function Su(n,e,t){return Rn(n,"value","once",t).pipe((0,re.w)(i=>{const s=[(0,Le.of)(i)];return e.forEach(r=>s.push(Rn(n,r,"on",t))),(0,Ye.T)(...s).pipe((0,tt.R)(Au,[]))}),(0,ze.x)())}(n,e=Oo(e),t)}function Fo(n,e,t){const i=(e=Oo(e)).map(s=>Rn(n,s,"on",t));return(0,Ye.T)(...i)}function Lo(n,e){return function(i,s){return xo(i,{stringCase:()=>n.child(i)[e](s),firebaseCase:()=>i[e](s),snapshotCase:()=>i.ref[e](s)})}}function Pu(n){return function(t){return t?xo(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function Wo(n,e){return function(){return Rn(n,"value","on",e)}}const Ou=new g.OlP("angularfire2.realtimeDatabaseURL"),Mu=new g.OlP("angularfire2.database.use-emulator");let Fu=(()=>{class n{constructor(t,i,s,r,o,a,l,u,_,m,v,w,I,N,K){this.schedulers=a;const he=l,Ce=(0,Y.on)(t,o,i);u&&Ao(Ce,o,_,v,w,I,m,N),this.database=(0,Y.cc)(`${Ce.name}.database.${s}`,"AngularFireDatabase",Ce.name,()=>{const je=o.runOutsideAngular(()=>Ce.database(s||void 0));return he&&je.useEmulator(...he),je},[he])}list(t,i){const s=this.schedulers.ngZone.runOutsideAngular(()=>Po(this.database,t));let r=s;return i&&(r=i(s)),function xu(n,e){const t=e.schedulers.outsideAngular,i=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Lo(i,"update"),set:Lo(i,"set"),push:s=>i.push(s),remove:Pu(i),snapshotChanges:s=>Mo(n,s,t).pipe(x.iC),stateChanges:s=>Fo(n,s,t).pipe(x.iC),auditTrail:s=>function Ru(n,e,t){return function Nu(n,e,t){return function ku(n,e){return Rn(n,"value","on",e).pipe((0,se.U)(t=>{let i;return t.payload.forEach(s=>(i=s.key,!1)),{data:t,lastKeyToLoad:i}}))}(n,t).pipe(function P(...n){const e=(0,S.jO)(n);return(0,mt.e)((t,i)=>{const s=n.length,r=new Array(s);let o=n.map(()=>!1),a=!1;for(let l=0;l<s;l++)(0,vt.Xf)(n[l]).subscribe((0,Ae.x)(i,u=>{r[l]=u,!a&&!o[l]&&(o[l]=!0,(a=o.every(yt.y))&&(o=null))},Q.Z));t.subscribe((0,Ae.x)(i,l=>{if(a){const u=[l,...r];i.next(e?e(...u):u)}}))})}(e),(0,se.U)(([s,r])=>{const o=s.lastKeyToLoad,a=r.map(l=>l.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),function W(n){return(0,mt.e)((e,t)=>{let i=!1,s=0;e.subscribe((0,Ae.x)(t,r=>(i||(i=!n(r,s++)))&&t.next(r)))})}(s=>-1===s.loadedKeys.indexOf(s.lastKeyToLoad)),(0,se.U)(s=>s.actions))}(n,Fo(n,e).pipe((0,tt.R)((s,r)=>[...s,r],[])),t)}(n,s,t).pipe(x.iC),valueChanges:(s,r)=>Mo(n,s,t).pipe((0,se.U)(a=>a.map(l=>r&&r.idField?Object.assign(Object.assign({},l.payload.val()),{[r.idField]:l.key}):l.payload.val())),x.iC)}}(r,this)}object(t){return function Du(n,e){return{query:n,snapshotChanges:()=>Wo(n,e.schedulers.outsideAngular)().pipe(x.iC),update:t=>n.ref.update(t),set:t=>n.ref.set(t),remove:()=>n.ref.remove(),valueChanges:()=>Wo(n,e.schedulers.outsideAngular)().pipe(x.iC,(0,se.U)(i=>i.payload.exists()?i.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>Po(this.database,t)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return n.\u0275fac=function(t){return new(t||n)(g.LFG(Y.Dh),g.LFG(Y.xv,8),g.LFG(Ou,8),g.LFG(g.Lbi),g.LFG(g.R0b),g.LFG(x.HU),g.LFG(Mu,8),g.LFG(Ro,8),g.LFG(Eo,8),g.LFG(wo,8),g.LFG(Io,8),g.LFG(bo,8),g.LFG(So,8),g.LFG(To,8),g.LFG(Co.nm,8))},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),Lu=(()=>{class n{constructor(){Eu.Z.registerVersion("angularfire",x.q4.full,"rtdb-compat")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=g.oAB({type:n}),n.\u0275inj=g.cJS({providers:[Fu]}),n})();var Wu=C(3861),Bu=C(9882),Bo=C(2296),He=C(6825),Pt=C(8484),Uu=C(2831),Vu=C(8180),Gu=C(9773),Uo=C(4300),ks=C(1088),wi=C(9594),Vo=C(3680);function Hu(n,e){if(1&n){const t=g.EpF();g.TgZ(0,"div",2)(1,"button",3),g.NdJ("click",function(){g.CHM(t);const s=g.oxw();return g.KtG(s.action())}),g._uU(2),g.qZA()()}if(2&n){const t=g.oxw();g.xp6(2),g.hij(" ",t.data.action," ")}}const ju=["label"];function Yu(n,e){}const zu=Math.pow(2,31)-1;class Ns{constructor(e,t){this._overlayRef=t,this._afterDismissed=new Nt.x,this._afterOpened=new Nt.x,this._onAction=new Nt.x,this._dismissedByAction=!1,this.containerInstance=e,e._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(e){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(e,zu))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}}const Go=new g.OlP("MatSnackBarData");class Ii{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}}let Ku=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275dir=g.lG2({type:n,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]}),e})(),Qu=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275dir=g.lG2({type:n,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]}),e})(),$u=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275dir=g.lG2({type:n,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]}),e})(),Zu=(()=>{var n;class e{constructor(i,s){this.snackBarRef=i,this.data=s}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}}return(n=e).\u0275fac=function(i){return new(i||n)(g.Y36(Ns),g.Y36(Go))},n.\u0275cmp=g.Xpm({type:n,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions","",4,"ngIf"],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(i,s){1&i&&(g.TgZ(0,"div",0),g._uU(1),g.qZA(),g.YNc(2,Hu,3,1,"div",1)),2&i&&(g.xp6(1),g.hij(" ",s.data.message,"\n"),g.xp6(1),g.Q6J("ngIf",s.hasAction))},dependencies:[An.O5,Bo.lW,Ku,Qu,$u],styles:[".mat-mdc-simple-snack-bar{display:flex}"],encapsulation:2,changeDetection:0}),e})();const Xu={snackBarState:(0,He.X$)("state",[(0,He.SB)("void, hidden",(0,He.oB)({transform:"scale(0.8)",opacity:0})),(0,He.SB)("visible",(0,He.oB)({transform:"scale(1)",opacity:1})),(0,He.eR)("* => visible",(0,He.jt)("150ms cubic-bezier(0, 0, 0.2, 1)")),(0,He.eR)("* => void, * => hidden",(0,He.jt)("75ms cubic-bezier(0.4, 0.0, 1, 1)",(0,He.oB)({opacity:0})))])};let Ju=0,qu=(()=>{var n;class e extends Pt.en{constructor(i,s,r,o,a){super(),this._ngZone=i,this._elementRef=s,this._changeDetectorRef=r,this._platform=o,this.snackBarConfig=a,this._document=(0,g.f3M)(An.K0),this._trackedModals=new Set,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new Nt.x,this._onExit=new Nt.x,this._onEnter=new Nt.x,this._animationState="void",this._liveElementId="mat-snack-bar-container-live-"+Ju++,this.attachDomPortal=l=>{this._assertNotAttached();const u=this._portalOutlet.attachDomPortal(l);return this._afterPortalAttached(),u},this._live="assertive"!==a.politeness||a.announcementMessage?"off"===a.politeness?"off":"polite":"assertive",this._platform.FIREFOX&&("polite"===this._live&&(this._role="status"),"assertive"===this._live&&(this._role="alert"))}attachComponentPortal(i){this._assertNotAttached();const s=this._portalOutlet.attachComponentPortal(i);return this._afterPortalAttached(),s}attachTemplatePortal(i){this._assertNotAttached();const s=this._portalOutlet.attachTemplatePortal(i);return this._afterPortalAttached(),s}onAnimationEnd(i){const{fromState:s,toState:r}=i;if(("void"===r&&"void"!==s||"hidden"===r)&&this._completeExit(),"visible"===r){const o=this._onEnter;this._ngZone.run(()=>{o.next(),o.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._ngZone.run(()=>{this._animationState="hidden",this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId)}),this._onExit}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe((0,Vu.q)(1)).subscribe(()=>{this._ngZone.run(()=>{this._onExit.next(),this._onExit.complete()})})}_afterPortalAttached(){const i=this._elementRef.nativeElement,s=this.snackBarConfig.panelClass;s&&(Array.isArray(s)?s.forEach(r=>i.classList.add(r)):i.classList.add(s)),this._exposeToModals()}_exposeToModals(){const i=this._liveElementId,s=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let r=0;r<s.length;r++){const o=s[r],a=o.getAttribute("aria-owns");this._trackedModals.add(o),a?-1===a.indexOf(i)&&o.setAttribute("aria-owns",a+" "+i):o.setAttribute("aria-owns",i)}}_clearFromModals(){this._trackedModals.forEach(i=>{const s=i.getAttribute("aria-owns");if(s){const r=s.replace(this._liveElementId,"").trim();r.length>0?i.setAttribute("aria-owns",r):i.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{const i=this._elementRef.nativeElement.querySelector("[aria-hidden]"),s=this._elementRef.nativeElement.querySelector("[aria-live]");if(i&&s){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&i.contains(document.activeElement)&&(r=document.activeElement),i.removeAttribute("aria-hidden"),s.appendChild(i),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}}return(n=e).\u0275fac=function(i){return new(i||n)(g.Y36(g.R0b),g.Y36(g.SBq),g.Y36(g.sBO),g.Y36(Uu.t4),g.Y36(Ii))},n.\u0275dir=g.lG2({type:n,viewQuery:function(i,s){if(1&i&&g.Gf(Pt.Pl,7),2&i){let r;g.iGM(r=g.CRH())&&(s._portalOutlet=r.first)}},features:[g.qOj]}),e})(),ed=(()=>{var n;class e extends qu{_afterPortalAttached(){super._afterPortalAttached();const i=this._label.nativeElement,s="mdc-snackbar__label";i.classList.toggle(s,!i.querySelector(`.${s}`))}}return(n=e).\u0275fac=function(){let t;return function(s){return(t||(t=g.n5z(n)))(s||n)}}(),n.\u0275cmp=g.Xpm({type:n,selectors:[["mat-snack-bar-container"]],viewQuery:function(i,s){if(1&i&&g.Gf(ju,7),2&i){let r;g.iGM(r=g.CRH())&&(s._label=r.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container","mdc-snackbar--open"],hostVars:1,hostBindings:function(i,s){1&i&&g.WFA("@state.done",function(o){return s.onAnimationEnd(o)}),2&i&&g.d8E("@state",s._animationState)},features:[g.qOj],decls:6,vars:3,consts:[[1,"mdc-snackbar__surface"],[1,"mat-mdc-snack-bar-label"],["label",""],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(i,s){1&i&&(g.TgZ(0,"div",0)(1,"div",1,2)(3,"div",3),g.YNc(4,Yu,0,0,"ng-template",4),g.qZA(),g._UZ(5,"div"),g.qZA()()),2&i&&(g.xp6(5),g.uIk("aria-live",s._live)("role",s._role)("id",s._liveElementId))},dependencies:[Pt.Pl],styles:['.mdc-snackbar{display:none;position:fixed;right:0;bottom:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;pointer-events:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mdc-snackbar--opening,.mdc-snackbar--open,.mdc-snackbar--closing{display:flex}.mdc-snackbar--open .mdc-snackbar__label,.mdc-snackbar--open .mdc-snackbar__actions{visibility:visible}.mdc-snackbar__surface{padding-left:0;padding-right:8px;display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;transform:scale(0.8);opacity:0}.mdc-snackbar__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-snackbar__surface::before{border-color:CanvasText}}[dir=rtl] .mdc-snackbar__surface,.mdc-snackbar__surface[dir=rtl]{padding-left:8px;padding-right:0}.mdc-snackbar--open .mdc-snackbar__surface{transform:scale(1);opacity:1;pointer-events:auto}.mdc-snackbar--closing .mdc-snackbar__surface{transform:scale(1)}.mdc-snackbar__label{padding-left:16px;padding-right:8px;width:100%;flex-grow:1;box-sizing:border-box;margin:0;visibility:hidden;padding-top:14px;padding-bottom:14px}[dir=rtl] .mdc-snackbar__label,.mdc-snackbar__label[dir=rtl]{padding-left:8px;padding-right:16px}.mdc-snackbar__label::before{display:inline;content:attr(data-mdc-snackbar-label-text)}.mdc-snackbar__actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box;visibility:hidden}.mdc-snackbar__action+.mdc-snackbar__dismiss{margin-left:8px;margin-right:0}[dir=rtl] .mdc-snackbar__action+.mdc-snackbar__dismiss,.mdc-snackbar__action+.mdc-snackbar__dismiss[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-snack-bar-container{margin:8px;--mdc-snackbar-container-shape:4px;position:static}.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:344px}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:100%}}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container{width:100vw}}.mat-mdc-snack-bar-container .mdc-snackbar__surface{max-width:672px}.mat-mdc-snack-bar-container .mdc-snackbar__surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{background-color:var(--mdc-snackbar-container-color)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{border-radius:var(--mdc-snackbar-container-shape)}.mat-mdc-snack-bar-container .mdc-snackbar__label{color:var(--mdc-snackbar-supporting-text-color)}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-size:var(--mdc-snackbar-supporting-text-size);font-family:var(--mdc-snackbar-supporting-text-font);font-weight:var(--mdc-snackbar-supporting-text-weight);line-height:var(--mdc-snackbar-supporting-text-line-height)}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){color:var(--mat-snack-bar-button-color);--mat-mdc-button-persistent-ripple-color: currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{background-color:currentColor;opacity:.1}.mat-mdc-snack-bar-container .mdc-snackbar__label::before{display:none}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-handset .mdc-snackbar__surface{width:100%}'],encapsulation:2,data:{animation:[Xu.snackBarState]}}),e})(),Ho=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=g.oAB({type:n}),n.\u0275inj=g.cJS({imports:[wi.U8,Pt.eL,An.ez,Bo.ot,Vo.BQ,Vo.BQ]}),e})();const jo=new g.OlP("mat-snack-bar-default-options",{providedIn:"root",factory:function td(){return new Ii}});let nd=(()=>{var n;class e{get _openedSnackBarRef(){const i=this._parentSnackBar;return i?i._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(i){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=i:this._snackBarRefAtThisLevel=i}constructor(i,s,r,o,a,l){this._overlay=i,this._live=s,this._injector=r,this._breakpointObserver=o,this._parentSnackBar=a,this._defaultConfig=l,this._snackBarRefAtThisLevel=null}openFromComponent(i,s){return this._attach(i,s)}openFromTemplate(i,s){return this._attach(i,s)}open(i,s="",r){const o={...this._defaultConfig,...r};return o.data={message:i,action:s},o.announcementMessage===i&&(o.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,o)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(i,s){const o=g.zs3.create({parent:s&&s.viewContainerRef&&s.viewContainerRef.injector||this._injector,providers:[{provide:Ii,useValue:s}]}),a=new Pt.C5(this.snackBarContainerComponent,s.viewContainerRef,o),l=i.attach(a);return l.instance.snackBarConfig=s,l.instance}_attach(i,s){const r={...new Ii,...this._defaultConfig,...s},o=this._createOverlay(r),a=this._attachSnackBarContainer(o,r),l=new Ns(a,o);if(i instanceof g.Rgc){const u=new Pt.UE(i,null,{$implicit:r.data,snackBarRef:l});l.instance=a.attachTemplatePortal(u)}else{const u=this._createInjector(r,l),_=new Pt.C5(i,void 0,u),m=a.attachComponentPortal(_);l.instance=m.instance}return this._breakpointObserver.observe(ks.u3.HandsetPortrait).pipe((0,Gu.R)(o.detachments())).subscribe(u=>{o.overlayElement.classList.toggle(this.handsetCssClass,u.matches)}),r.announcementMessage&&a._onAnnounce.subscribe(()=>{this._live.announce(r.announcementMessage,r.politeness)}),this._animateSnackBar(l,r),this._openedSnackBarRef=l,this._openedSnackBarRef}_animateSnackBar(i,s){i.afterDismissed().subscribe(()=>{this._openedSnackBarRef==i&&(this._openedSnackBarRef=null),s.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{i.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):i.containerInstance.enter(),s.duration&&s.duration>0&&i.afterOpened().subscribe(()=>i._dismissAfter(s.duration))}_createOverlay(i){const s=new wi.X_;s.direction=i.direction;let r=this._overlay.position().global();const o="rtl"===i.direction,a="left"===i.horizontalPosition||"start"===i.horizontalPosition&&!o||"end"===i.horizontalPosition&&o,l=!a&&"center"!==i.horizontalPosition;return a?r.left("0"):l?r.right("0"):r.centerHorizontally(),"top"===i.verticalPosition?r.top("0"):r.bottom("0"),s.positionStrategy=r,this._overlay.create(s)}_createInjector(i,s){return g.zs3.create({parent:i&&i.viewContainerRef&&i.viewContainerRef.injector||this._injector,providers:[{provide:Ns,useValue:s},{provide:Go,useValue:i.data}]})}}return(n=e).\u0275fac=function(i){return new(i||n)(g.LFG(wi.aV),g.LFG(Uo.Kd),g.LFG(g.zs3),g.LFG(ks.Yg),g.LFG(n,12),g.LFG(jo))},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac}),e})(),id=(()=>{var n;class e extends nd{constructor(i,s,r,o,a,l){super(i,s,r,o,a,l),this.simpleSnackBarComponent=Zu,this.snackBarContainerComponent=ed,this.handsetCssClass="mat-mdc-snack-bar-handset"}}return(n=e).\u0275fac=function(i){return new(i||n)(g.LFG(wi.aV),g.LFG(Uo.Kd),g.LFG(g.zs3),g.LFG(ks.Yg),g.LFG(n,12),g.LFG(jo))},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac,providedIn:Ho}),e})();var sd=C(7920);let rd=(()=>{var n;class e{constructor(){this._farmsService=(0,g.f3M)(Bu.i),this._snackBar=(0,g.f3M)(id),this._router=(0,g.f3M)(sd.F0)}saveNewFarm(i){var s=this;return(0,b.Z)(function*(){yield s._farmsService.createNewFarm(i),s._snackBar.open("Finca creada","",{duration:1e3}),s._router.navigateByUrl("/farms")})()}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=g.Xpm({type:n,selectors:[["app-create-farm"]],standalone:!0,features:[g.jDz],decls:1,vars:0,consts:[["formTitle","Crear finca",3,"submitFarm"]],template:function(i,s){1&i&&(g.TgZ(0,"app-farm-form",0),g.NdJ("submitFarm",function(o){return s.saveNewFarm(o)}),g.qZA())},dependencies:[An.ez,Wu.G,Lu,Ho],styles:["[_nghost-%COMP%]{display:flex;justify-content:center}"]}),e})()},3106:(et,Fe,C)=>{C.d(Fe,{Z:()=>yt});var b=C(9058),g=C(4537),f=C(534),G=C(7879);class Le{constructor(S,P){this._delegate=S,this.firebase=P,(0,f._addComponent)(S,new g.wA("app-compat",()=>this,"PUBLIC")),this.container=S.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(S){this._delegate.automaticDataCollectionEnabled=S}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(S=>{this._delegate.checkDestroyed(),S()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,f.deleteApp)(this._delegate)))}_getService(S,P=f._DEFAULT_ENTRY_NAME){var W;this._delegate.checkDestroyed();const x=this._delegate.container.getProvider(S);return!x.isInitialized()&&"EXPLICIT"===(null===(W=x.getComponent())||void 0===W?void 0:W.instantiationMode)&&x.initialize(),x.getImmediate({identifier:P})}_removeServiceInstance(S,P=f._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(S).clearInstance(P)}_addComponent(S){(0,f._addComponent)(this._delegate,S)}_addOrOverwriteComponent(S){(0,f._addOrOverwriteComponent)(this._delegate,S)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const se=new b.LL("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),tt=function re(){const Q=function fe(Q){const S={},P={__esModule:!0,initializeApp:function Y(O,c={}){const X=f.initializeApp(O,c);if((0,b.r3)(S,X.name))return S[X.name];const me=new Q(X,P);return S[X.name]=me,me},app:x,registerVersion:f.registerVersion,setLogLevel:f.setLogLevel,onLog:f.onLog,apps:null,SDK_VERSION:f.SDK_VERSION,INTERNAL:{registerComponent:function le(O){const c=O.name,X=c.replace("-compat","");if(f._registerComponent(O)&&"PUBLIC"===O.type){const me=(ue=x())=>{if("function"!=typeof ue[X])throw se.create("invalid-app-argument",{appName:c});return ue[X]()};void 0!==O.serviceProps&&(0,b.ZB)(me,O.serviceProps),P[X]=me,Q.prototype[X]=function(...ue){return this._getService.bind(this,c).apply(this,O.multipleInstances?ue:[])}}return"PUBLIC"===O.type?P[X]:null},removeApp:function W(O){delete S[O]},useAsService:function $(O,c){return"serverAuth"===c?null:c},modularAPIs:f}};function x(O){if(!(0,b.r3)(S,O=O||f._DEFAULT_ENTRY_NAME))throw se.create("no-app",{appName:O});return S[O]}return P.default=P,Object.defineProperty(P,"apps",{get:function ae(){return Object.keys(S).map(O=>S[O])}}),x.App=Q,P}(Le);return Q.INTERNAL=Object.assign(Object.assign({},Q.INTERNAL),{createFirebaseNamespace:re,extendNamespace:function S(P){(0,b.ZB)(Q,P)},createSubscribe:b.ne,ErrorFactory:b.LL,deepExtend:b.ZB}),Q}(),ze=new G.Yd("@firebase/app-compat");if((0,b.jU)()&&void 0!==self.firebase){ze.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const Q=self.firebase.SDK_VERSION;Q&&Q.indexOf("LITE")>=0&&ze.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const yt=tt;!function vt(Q){(0,f.registerVersion)("@firebase/app-compat","0.2.13",Q)}()},7142:(et,Fe,C)=>{C.d(Fe,{Z:()=>b.Z});var b=C(3106);b.Z.registerVersion("firebase","9.23.0","app-compat")},6365:(et,Fe,C)=>{C.r(Fe);var b=C(5861),g=C(3106),f=C(6878),G=C(9058),se=(C(534),C(7879),C(4537));function fe(){return window}function ze(){return ze=(0,b.Z)(function*(p,h,d){var y;const{BuildInfo:E}=fe();(0,f.as)(h.sessionId,"AuthEvent did not contain a session ID");const T=yield function P(p){return W.apply(this,arguments)}(h.sessionId),M={};return(0,f.at)()?M.ibi=E.packageName:(0,f.au)()?M.apn=E.packageName:(0,f.av)(p,"operation-not-supported-in-this-environment"),E.displayName&&(M.appDisplayName=E.displayName),M.sessionId=T,(0,f.aw)(p,d,h.type,void 0,null!==(y=h.eventId)&&void 0!==y?y:void 0,M)}),ze.apply(this,arguments)}function Ae(){return(Ae=(0,b.Z)(function*(p){const{BuildInfo:h}=fe(),d={};(0,f.at)()?d.iosBundleId=h.packageName:(0,f.au)()?d.androidPackageName=h.packageName:(0,f.av)(p,"operation-not-supported-in-this-environment"),yield(0,f.ax)(p,d)})).apply(this,arguments)}function Q(){return(Q=(0,b.Z)(function*(p,h,d){const{cordova:y}=fe();let E=()=>{};try{yield new Promise((T,M)=>{let U=null;function ie(){var F;T();const Be=null===(F=y.plugins.browsertab)||void 0===F?void 0:F.close;"function"==typeof Be&&Be(),"function"==typeof d?.close&&d.close()}function _e(){U||(U=window.setTimeout(()=>{M((0,f.az)(p,"redirect-cancelled-by-user"))},2e3))}function Ie(){"visible"===document?.visibilityState&&_e()}h.addPassiveListener(ie),document.addEventListener("resume",_e,!1),(0,f.au)()&&document.addEventListener("visibilitychange",Ie,!1),E=()=>{h.removePassiveListener(ie),document.removeEventListener("resume",_e,!1),document.removeEventListener("visibilitychange",Ie,!1),U&&window.clearTimeout(U)}})}finally{E()}})).apply(this,arguments)}function W(){return(W=(0,b.Z)(function*(p){const h=function x(p){if((0,f.as)(/[0-9a-zA-Z]+/.test(p),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(p);const h=new ArrayBuffer(p.length),d=new Uint8Array(h);for(let y=0;y<p.length;y++)d[y]=p.charCodeAt(y);return d}(p),d=yield crypto.subtle.digest("SHA-256",h);return Array.from(new Uint8Array(d)).map(E=>E.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class ae extends f.aB{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(h=>{this.resolveInialized=h})}addPassiveListener(h){this.passiveListeners.add(h)}removePassiveListener(h){this.passiveListeners.delete(h)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(h){return this.resolveInialized(),this.passiveListeners.forEach(d=>d(h)),super.onEvent(h)}initialized(){var h=this;return(0,b.Z)(function*(){yield h.initPromise})()}}function O(p){return c.apply(this,arguments)}function c(){return(c=(0,b.Z)(function*(p){const h=yield ue()._get(Re(p));return h&&(yield ue()._remove(Re(p))),h})).apply(this,arguments)}function me(){const p=[];for(let d=0;d<20;d++){const y=Math.floor(62*Math.random());p.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(y))}return p.join("")}function ue(){return(0,f.aC)(f.b)}function Re(p){return(0,f.aD)("authEvent",p.config.apiKey,p.name)}function Dt(p){if(!p?.includes("?"))return{};const[h,...d]=p.split("?");return(0,G.zd)(d.join("?"))}const Kt=class Ke{constructor(){this._redirectPersistence=f.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=f.aE,this._overrideRedirectResult=f.aF}_initialize(h){var d=this;return(0,b.Z)(function*(){const y=h._key();let E=d.eventManagers.get(y);return E||(E=new ae(h),d.eventManagers.set(y,E),d.attachCallbackListeners(h,E)),E})()}_openPopup(h){(0,f.av)(h,"operation-not-supported-in-this-environment")}_openRedirect(h,d,y,E){var T=this;return(0,b.Z)(function*(){!function S(p){var h,d,y,E,T,M,U,ie,_e,Ie;const F=fe();(0,f.aA)("function"==typeof(null===(h=F?.universalLinks)||void 0===h?void 0:h.subscribe),p,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,f.aA)(typeof(null===(d=F?.BuildInfo)||void 0===d?void 0:d.packageName)<"u",p,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,f.aA)("function"==typeof(null===(T=null===(E=null===(y=F?.cordova)||void 0===y?void 0:y.plugins)||void 0===E?void 0:E.browsertab)||void 0===T?void 0:T.openUrl),p,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,f.aA)("function"==typeof(null===(ie=null===(U=null===(M=F?.cordova)||void 0===M?void 0:M.plugins)||void 0===U?void 0:U.browsertab)||void 0===ie?void 0:ie.isAvailable),p,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,f.aA)("function"==typeof(null===(Ie=null===(_e=F?.cordova)||void 0===_e?void 0:_e.InAppBrowser)||void 0===Ie?void 0:Ie.open),p,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(h);const M=yield T._initialize(h);yield M.initialized(),M.resetRedirect(),(0,f.aG)(),yield T._originValidation(h);const U=function le(p,h,d=null){return{type:h,eventId:d,urlResponse:null,sessionId:me(),postBody:null,tenantId:p.tenantId,error:(0,f.az)(p,"no-auth-event")}}(h,y,E);yield function $(p,h){return ue()._set(Re(p),h)}(h,U);const ie=yield function tt(p,h,d){return ze.apply(this,arguments)}(h,U,d),_e=yield function vt(p){const{cordova:h}=fe();return new Promise(d=>{h.plugins.browsertab.isAvailable(y=>{let E=null;y?h.plugins.browsertab.openUrl(p):E=h.InAppBrowser.open(p,(0,f.ay)()?"_blank":"_system","location=yes"),d(E)})})}(ie);return function yt(p,h,d){return Q.apply(this,arguments)}(h,M,_e)})()}_isIframeWebStorageSupported(h,d){throw new Error("Method not implemented.")}_originValidation(h){const d=h._key();return this.originValidationPromises[d]||(this.originValidationPromises[d]=function mt(p){return Ae.apply(this,arguments)}(h)),this.originValidationPromises[d]}attachCallbackListeners(h,d){const{universalLinks:y,handleOpenURL:E,BuildInfo:T}=fe(),M=setTimeout((0,b.Z)(function*(){yield O(h),d.onEvent(Qe())}),500),U=function(){var Ie=(0,b.Z)(function*(F){clearTimeout(M);const Be=yield O(h);let nn=null;Be&&F?.url&&(nn=function X(p,h){var d,y;const E=function bi(p){const h=Dt(p),d=h.link?decodeURIComponent(h.link):void 0,y=Dt(d).link,E=h.deep_link_id?decodeURIComponent(h.deep_link_id):void 0;return Dt(E).link||E||y||d||p}(h);if(E.includes("/__/auth/callback")){const T=Dt(E),M=T.firebaseError?function kn(p){try{return JSON.parse(p)}catch{return null}}(decodeURIComponent(T.firebaseError)):null,U=null===(y=null===(d=M?.code)||void 0===d?void 0:d.split("auth/"))||void 0===y?void 0:y[1],ie=U?(0,f.az)(U):null;return ie?{type:p.type,eventId:p.eventId,tenantId:p.tenantId,error:ie,urlResponse:null,sessionId:null,postBody:null}:{type:p.type,eventId:p.eventId,tenantId:p.tenantId,sessionId:p.sessionId,urlResponse:E,postBody:null}}return null}(Be,F.url)),d.onEvent(nn||Qe())});return function(Be){return Ie.apply(this,arguments)}}();typeof y<"u"&&"function"==typeof y.subscribe&&y.subscribe(null,U);const ie=E,_e=`${T.packageName.toLowerCase()}://`;fe().handleOpenURL=function(){var Ie=(0,b.Z)(function*(F){if(F.toLowerCase().startsWith(_e)&&U({url:F}),"function"==typeof ie)try{ie(F)}catch(Be){console.error(Be)}});return function(F){return Ie.apply(this,arguments)}}()}};function Qe(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,f.az)("no-auth-event")}}function nt(){var p;return(null===(p=self?.location)||void 0===p?void 0:p.protocol)||null}function J(p=(0,G.z$)()){return!("file:"!==nt()&&"ionic:"!==nt()&&"capacitor:"!==nt()||!p.toLowerCase().match(/iphone|ipad|ipod|android/))}function On(){try{const p=self.localStorage,h=f.aL();if(p)return p.setItem(h,"1"),p.removeItem(h),!function ne(p=(0,G.z$)()){return function Qt(){return(0,G.w1)()&&11===document?.documentMode}()||function Ee(p=(0,G.z$)()){return/Edge\/\d+/.test(p)}(p)}()||(0,G.hl)()}catch{return it()&&(0,G.hl)()}return!1}function it(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function $t(){return(function Dn(){return"http:"===nt()||"https:"===nt()}()||(0,G.ru)()||J())&&!function Et(){return(0,G.b$)()||(0,G.UG)()}()&&On()&&!it()}function ke(){return J()&&typeof document<"u"}function Pe(){return(Pe=(0,b.Z)(function*(){return!!ke()&&new Promise(p=>{const h=setTimeout(()=>{p(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(h),p(!0)})})})).apply(this,arguments)}const te={LOCAL:"local",NONE:"none",SESSION:"session"},Ze=f.aA,Zt="persistence";function Ot(p){return Xt.apply(this,arguments)}function Xt(){return(Xt=(0,b.Z)(function*(p){yield p._initializationPromise;const h=Mn(),d=f.aD(Zt,p.config.apiKey,p.name);h&&h.setItem(d,p._getPersistence())})).apply(this,arguments)}function Mn(){var p;try{return(null===(p=function Si(){return typeof window<"u"?window:null}())||void 0===p?void 0:p.sessionStorage)||null}catch{return null}}const Ai=f.aA;class We{constructor(){this.browserResolver=f.aC(f.k),this.cordovaResolver=f.aC(Kt),this.underlyingResolver=null,this._redirectPersistence=f.a,this._completeRedirectFn=f.aE,this._overrideRedirectResult=f.aF}_initialize(h){var d=this;return(0,b.Z)(function*(){return yield d.selectUnderlyingResolver(),d.assertedUnderlyingResolver._initialize(h)})()}_openPopup(h,d,y,E){var T=this;return(0,b.Z)(function*(){return yield T.selectUnderlyingResolver(),T.assertedUnderlyingResolver._openPopup(h,d,y,E)})()}_openRedirect(h,d,y,E){var T=this;return(0,b.Z)(function*(){return yield T.selectUnderlyingResolver(),T.assertedUnderlyingResolver._openRedirect(h,d,y,E)})()}_isIframeWebStorageSupported(h,d){this.assertedUnderlyingResolver._isIframeWebStorageSupported(h,d)}_originValidation(h){return this.assertedUnderlyingResolver._originValidation(h)}get _shouldInitProactively(){return ke()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Ai(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var h=this;return(0,b.Z)(function*(){if(h.underlyingResolver)return;const d=yield function Ne(){return Pe.apply(this,arguments)}();h.underlyingResolver=d?h.cordovaResolver:h.browserResolver})()}}function Fn(p){return p.unwrap()}function st(p){return rt(p)}function rt(p){const{_tokenResponse:h}=p instanceof G.ZR?p.customData:p;if(!h)return null;if(!(p instanceof G.ZR)&&"temporaryProof"in h&&"phoneNumber"in h)return f.P.credentialFromResult(p);const d=h.providerId;if(!d||d===f.p.PASSWORD)return null;let y;switch(d){case f.p.GOOGLE:y=f.V;break;case f.p.FACEBOOK:y=f.U;break;case f.p.GITHUB:y=f.W;break;case f.p.TWITTER:y=f.Z;break;default:const{oauthIdToken:E,oauthAccessToken:T,oauthTokenSecret:M,pendingToken:U,nonce:ie}=h;return T||M||E||U?U?d.startsWith("saml.")?f.aO._create(d,U):f.L._fromParams({providerId:d,signInMethod:d,pendingToken:U,idToken:E,accessToken:T}):new f.X(d).credential({idToken:E,accessToken:T,rawNonce:ie}):null}return p instanceof G.ZR?y.credentialFromError(p):y.credentialFromResult(p)}function ce(p,h){return h.catch(d=>{throw d instanceof G.ZR&&function Ri(p,h){var d;const y=null===(d=h.customData)||void 0===d?void 0:d._tokenResponse;if("auth/multi-factor-auth-required"===h?.code)h.resolver=new Mt(p,f.aq(p,h));else if(y){const E=rt(h),T=h;E&&(T.credential=E,T.tenantId=y.tenantId||void 0,T.email=y.email||void 0,T.phoneNumber=y.phoneNumber||void 0)}}(p,d),d}).then(d=>{const E=d.user;return{operationType:d.operationType,credential:st(d),additionalUserInfo:f.ao(d),user:we.getOrCreate(E)}})}function Jt(p,h){return Xe.apply(this,arguments)}function Xe(){return(Xe=(0,b.Z)(function*(p,h){const d=yield h;return{verificationId:d.verificationId,confirm:y=>ce(p,d.confirm(y))}})).apply(this,arguments)}class Mt{constructor(h,d){this.resolver=d,this.auth=function Ln(p){return p.wrapped()}(h)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(h){return ce(Fn(this.auth),this.resolver.resolveSignIn(h))}}class we{constructor(h){this._delegate=h,this.multiFactor=f.ar(h)}static getOrCreate(h){return we.USER_MAP.has(h)||we.USER_MAP.set(h,new we(h)),we.USER_MAP.get(h)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(h){return this._delegate.getIdTokenResult(h)}getIdToken(h){return this._delegate.getIdToken(h)}linkAndRetrieveDataWithCredential(h){return this.linkWithCredential(h)}linkWithCredential(h){var d=this;return(0,b.Z)(function*(){return ce(d.auth,f.a0(d._delegate,h))})()}linkWithPhoneNumber(h,d){var y=this;return(0,b.Z)(function*(){return Jt(y.auth,f.l(y._delegate,h,d))})()}linkWithPopup(h){var d=this;return(0,b.Z)(function*(){return ce(d.auth,f.d(d._delegate,h,We))})()}linkWithRedirect(h){var d=this;return(0,b.Z)(function*(){return yield Ot(f.aH(d.auth)),f.g(d._delegate,h,We)})()}reauthenticateAndRetrieveDataWithCredential(h){return this.reauthenticateWithCredential(h)}reauthenticateWithCredential(h){var d=this;return(0,b.Z)(function*(){return ce(d.auth,f.a1(d._delegate,h))})()}reauthenticateWithPhoneNumber(h,d){return Jt(this.auth,f.r(this._delegate,h,d))}reauthenticateWithPopup(h){return ce(this.auth,f.e(this._delegate,h,We))}reauthenticateWithRedirect(h){var d=this;return(0,b.Z)(function*(){return yield Ot(f.aH(d.auth)),f.h(d._delegate,h,We)})()}sendEmailVerification(h){return f.ae(this._delegate,h)}unlink(h){var d=this;return(0,b.Z)(function*(){return yield f.an(d._delegate,h),d})()}updateEmail(h){return f.aj(this._delegate,h)}updatePassword(h){return f.ak(this._delegate,h)}updatePhoneNumber(h){return f.u(this._delegate,h)}updateProfile(h){return f.ai(this._delegate,h)}verifyBeforeUpdateEmail(h,d){return f.af(this._delegate,h,d)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}we.USER_MAP=new WeakMap;const ot=f.aA;let qt=(()=>{class p{constructor(d,y){if(this.app=d,y.isInitialized())return this._delegate=y.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:E}=d.options;ot(E,"invalid-api-key",{appName:d.name}),ot(E,"invalid-api-key",{appName:d.name});const T=typeof window<"u"?We:void 0;this._delegate=y.initialize({options:{persistence:Wn(E,d.name),popupRedirectResolver:T}}),this._delegate._updateErrorMap(f.D),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?we.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(d){this._delegate.languageCode=d}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(d){this._delegate.tenantId=d}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(d,y){f.I(this._delegate,d,y)}applyActionCode(d){return f.a5(this._delegate,d)}checkActionCode(d){return f.a6(this._delegate,d)}confirmPasswordReset(d,y){return f.a4(this._delegate,d,y)}createUserWithEmailAndPassword(d,y){var E=this;return(0,b.Z)(function*(){return ce(E._delegate,f.a8(E._delegate,d,y))})()}fetchProvidersForEmail(d){return this.fetchSignInMethodsForEmail(d)}fetchSignInMethodsForEmail(d){return f.ad(this._delegate,d)}isSignInWithEmailLink(d){return f.ab(this._delegate,d)}getRedirectResult(){var d=this;return(0,b.Z)(function*(){ot($t(),d._delegate,"operation-not-supported-in-this-environment");const y=yield f.j(d._delegate,We);return y?ce(d._delegate,Promise.resolve(y)):{credential:null,user:null}})()}addFrameworkForLogging(d){!function Pn(p,h){(0,f.aH)(p)._logFramework(h)}(this._delegate,d)}onAuthStateChanged(d,y,E){const{next:T,error:M,complete:U}=en(d,y,E);return this._delegate.onAuthStateChanged(T,M,U)}onIdTokenChanged(d,y,E){const{next:T,error:M,complete:U}=en(d,y,E);return this._delegate.onIdTokenChanged(T,M,U)}sendSignInLinkToEmail(d,y){return f.aa(this._delegate,d,y)}sendPasswordResetEmail(d,y){return f.a3(this._delegate,d,y||void 0)}setPersistence(d){var y=this;return(0,b.Z)(function*(){let E;switch(function q(p,h){Ze(Object.values(te).includes(h),p,"invalid-persistence-type"),(0,G.b$)()?Ze(h!==te.SESSION,p,"unsupported-persistence-type"):(0,G.UG)()?Ze(h===te.NONE,p,"unsupported-persistence-type"):it()?Ze(h===te.NONE||h===te.LOCAL&&(0,G.hl)(),p,"unsupported-persistence-type"):Ze(h===te.NONE||On(),p,"unsupported-persistence-type")}(y._delegate,d),d){case te.SESSION:E=f.a;break;case te.LOCAL:E=(yield f.aC(f.i)._isAvailable())?f.i:f.b;break;case te.NONE:E=f.N;break;default:return f.av("argument-error",{appName:y._delegate.name})}return y._delegate.setPersistence(E)})()}signInAndRetrieveDataWithCredential(d){return this.signInWithCredential(d)}signInAnonymously(){return ce(this._delegate,f._(this._delegate))}signInWithCredential(d){return ce(this._delegate,f.$(this._delegate,d))}signInWithCustomToken(d){return ce(this._delegate,f.a2(this._delegate,d))}signInWithEmailAndPassword(d,y){return ce(this._delegate,f.a9(this._delegate,d,y))}signInWithEmailLink(d,y){return ce(this._delegate,f.ac(this._delegate,d,y))}signInWithPhoneNumber(d,y){return Jt(this._delegate,f.s(this._delegate,d,y))}signInWithPopup(d){var y=this;return(0,b.Z)(function*(){return ot($t(),y._delegate,"operation-not-supported-in-this-environment"),ce(y._delegate,f.c(y._delegate,d,We))})()}signInWithRedirect(d){var y=this;return(0,b.Z)(function*(){return ot($t(),y._delegate,"operation-not-supported-in-this-environment"),yield Ot(y._delegate),f.f(y._delegate,d,We)})()}updateCurrentUser(d){return this._delegate.updateCurrentUser(d)}verifyPasswordResetCode(d){return f.a7(this._delegate,d)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return p.Persistence=te,p})();function en(p,h,d){let y=p;"function"!=typeof p&&({next:y,error:h,complete:d}=p);const E=y;return{next:M=>E(M&&we.getOrCreate(M)),error:h,complete:d}}function Wn(p,h){const d=function Ti(p,h){const d=Mn();if(!d)return[];const y=f.aD(Zt,p,h);switch(d.getItem(y)){case te.NONE:return[f.N];case te.LOCAL:return[f.i,f.a];case te.SESSION:return[f.a];default:return[]}}(p,h);if(typeof self<"u"&&!d.includes(f.i)&&d.push(f.i),typeof window<"u")for(const y of[f.b,f.a])d.includes(y)||d.push(y);return d.includes(f.N)||d.push(f.N),d}class Ft{constructor(){this.providerId="phone",this._delegate=new f.P(Fn(g.Z.auth()))}static credential(h,d){return f.P.credential(h,d)}verifyPhoneNumber(h,d){return this._delegate.verifyPhoneNumber(h,d)}unwrap(){return this._delegate}}Ft.PHONE_SIGN_IN_METHOD=f.P.PHONE_SIGN_IN_METHOD,Ft.PROVIDER_ID=f.P.PROVIDER_ID;const Bn=f.aA;class tn{constructor(h,d,y=g.Z.app()){var E;Bn(null===(E=y.options)||void 0===E?void 0:E.apiKey,"invalid-api-key",{appName:y.name}),this._delegate=new f.R(h,d,y.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Vn(p){p.INTERNAL.registerComponent(new se.wA("auth-compat",h=>{const d=h.getProvider("app-compat").getImmediate(),y=h.getProvider("auth");return new qt(d,y)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:f.A.EMAIL_SIGNIN,PASSWORD_RESET:f.A.PASSWORD_RESET,RECOVER_EMAIL:f.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:f.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:f.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:f.A.VERIFY_EMAIL}},EmailAuthProvider:f.Q,FacebookAuthProvider:f.U,GithubAuthProvider:f.W,GoogleAuthProvider:f.V,OAuthProvider:f.X,SAMLAuthProvider:f.Y,PhoneAuthProvider:Ft,PhoneMultiFactorGenerator:f.m,RecaptchaVerifier:tn,TwitterAuthProvider:f.Z,Auth:qt,AuthCredential:f.J,Error:G.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),p.registerVersion("@firebase/auth-compat","0.4.2")}(g.Z)}}]);